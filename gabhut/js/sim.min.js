const DOM_ELEMENTS={topOfPage:document.getElementById("top"),atkType:document.getElementById("penCritSelect"),weapon:document.getElementById("weaponSelect"),wElem:document.getElementById("weaponElementSelect"),tSize:document.getElementById("targetSizeSelect"),tRace:document.getElementById("targetRaceSelect"),tAttr:document.getElementById("targetElementSelect"),tDef:document.getElementById("targetDefSelect"),blueSet:document.getElementById("blueSet"),blueSetLabel:document.getElementById("blueSetLabel"),vesperSet:document.getElementById("vesperSet"),vesperSetLabel:document.getElementById("vesperSetLabel"),whiteSet:document.getElementById("whiteSet"),whiteSetLabel:document.getElementById("whiteSetLabel"),tDefLabel:document.getElementById("tDefLabel"),atkTypeLabel:document.getElementById("atkTypeLabel"),weaponLabel:document.getElementById("weaponLabel"),wElemLabel:document.getElementById("wElemLabel"),tSizeLabel:document.getElementById("tSizeLabel"),tRaceLabel:document.getElementById("tRaceLabel"),tAttrLabel:document.getElementById("tAttrLabel"),pen:document.getElementById("pen"),crit:document.getElementById("crit"),dmgStack:document.getElementById("dmgStack"),dmgStackTips:document.getElementById("dmgStackTips"),dmg:document.getElementById("dmg"),elemEnh:document.getElementById("elemEnhance"),sizeEnh:document.getElementById("sizeEnhance"),race:document.getElementById("race"),attr:document.getElementById("attr"),penLabel:document.getElementById("penLabel"),critLabel:document.getElementById("critLabel"),dmgLabel:document.getElementById("dmgLabel"),elemEnhLabel:document.getElementById("elemEnhLabel"),sizeEnhLabel:document.getElementById("sizeLabel"),raceLabel:document.getElementById("raceLabel"),attrLabel:document.getElementById("attrLabel"),hasil:document.getElementById("hasil"),rec:document.getElementById("recommendations"),submit:document.getElementById("submitBtn"),resetRek:document.getElementById("resetRekomenBtn"),resetAll:document.getElementById("resetAllBtn"),testSpear:document.getElementById("testSpear"),testReaper:document.getElementById("testReaper"),snackbar:document.getElementById("snackbar"),log:document.getElementById("log"),openLog:document.getElementById("openLog"),closeLog:document.getElementById("closeLog")},isEmpty=e=>null==e||""===e,clearNumericInput=e=>{e&&(e.value="")},VESPER_SET={0:8,1:16,2:24,3:32,4:40,5:48,6:56,7:64,8:72,9:80},BLUE_SET={3:{30:5,40:7.5,50:10,60:12.5,70:15,80:17.5,90:20,100:22.5,110:25,120:27.5,130:30,140:32.5,150:35}},WHITE_SET={"Tier 0":30,"Tier 1":36,"Tier 2":42,"Tier 3":48,"Tier 4":54},DEFENSE_TABLE={"0def":{def:0,dmgred:0},"Avg. MVP Lvl.130":{def:182.27,dmgred:148.1},"Avg. MINI Lvl.130":{def:206.45,dmgred:165.52},"Avg. MVP MINI Lvl.130":{def:194.36,dmgred:156.81},"Avg. MVP Lvl.140":{def:155.32,dmgred:191.35},"Avg. MINI Lvl.140":{def:161.41,dmgred:233.48},"Avg. MVP MINI Lvl.140":{def:158.37,dmgred:212.41},"Avg. MVP Lvl.150":{def:191.03,dmgred:283.92},"Avg. MINI Lvl.150":{def:198.53,dmgred:324.23},"Avg. MVP MINI Lvl.150":{def:194.78,dmgred:304.08},"Avg. Small MVP Lv.140":{def:130.18,dmgred:272.8,sizeMob:"Small"},"Avg. Medium MVP Lv.140":{def:199.62,dmgred:195.88,sizeMob:"Medium"},"Avg. Large MVP Lv.140":{def:143.05,dmgred:184.84,sizeMob:"Large"},"Avg. Small MINI Lv.140":{def:161.12,dmgred:225.97,sizeMob:"Small"},"Avg. Medium MINI Lv.140":{def:148.23,dmgred:212.13,sizeMob:"Medium"},"Avg. Large MINI Lv.140":{def:178.61,dmgred:267.37,sizeMob:"Large"},"Avg. Small MVP Lv.150":{def:161.98,dmgred:361,sizeMob:"Small"},"Avg. Medium MVP Lv.150":{def:240.07,dmgred:273.72,sizeMob:"Medium"},"Avg. Large MVP Lv.150":{def:177.51,dmgred:282.29,sizeMob:"Large"},"Avg. Small MINI Lv.150":{def:198.01,dmgred:312.15,sizeMob:"Small"},"Avg. Medium MINI Lv.150":{def:182.88,dmgred:304.72,sizeMob:"Medium"},"Avg. Large MINI Lv.150":{def:219.08,dmgred:359.67,sizeMob:"Large"},"Phreeoni Lv.140":{def:106.98,dmgred:204.6,sizeMob:"Large",raceMob:"Brute",attributeMob:"Neutral"},"Mistress Lv.140":{def:130.18,dmgred:272.8,sizeMob:"Small",raceMob:"Insect",attributeMob:"Wind"},"Eddga Lv.140":{def:106.98,dmgred:204.6,sizeMob:"Large",raceMob:"Brute",attributeMob:"Fire"},"Kraken Lv.140":{def:130.18,dmgred:272.8,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Maya Lv.140":{def:98.97,dmgred:136.4,sizeMob:"Large",raceMob:"Insect",attributeMob:"Earth"},"Orc Hero Lv.140":{def:82.47,dmgred:136.4,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Pharaoh Lv.140":{def:98.97,dmgred:136.4,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Shadow"},"Orc Lord Lv.140":{def:82.47,dmgred:136.4,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Doppelganger Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Amon Ra Lv.140":{def:106.98,dmgred:204.6,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Morroc Lv.140":{def:131.97,dmgred:136.4,sizeMob:"Large",raceMob:"Demon",attributeMob:"Shadow"},"Time Holder Lv.140":{def:164.97,dmgred:136.4,sizeMob:"Large",raceMob:"Demon",attributeMob:"Neutral"},"Tao Gunka Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Large",raceMob:"Demon",attributeMob:"Neutral"},"Lost Dragon Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Shadow"},"Fallen Bishop Lv.140":{def:164.97,dmgred:136.4,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Lord of the Dead Lv.140":{def:131.97,dmgred:136.4,sizeMob:"Large",raceMob:"Demon",attributeMob:"Shadow"},"Arc Angeling Lv.140":{def:164.97,dmgred:136.4,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"},"Gioia Lv.140":{def:212.68,dmgred:272.8,sizeMob:"Large",raceMob:"Formless",attributeMob:"Wind"},"RSX-0806 Lv.140":{def:238.66,dmgred:202,sizeMob:"Medium",raceMob:"Formless",attributeMob:"Neutral"},"Nidhoggr's Shadow Lv.140":{def:181.21,dmgred:134,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Shadow"},"Gloom Under Night Lv.140":{def:306,dmgred:300,sizeMob:"Large",raceMob:"Formless",attributeMob:"Ghost"},"Retribution Lv.140":{def:256.5,dmgred:300,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Shadow"},"Dragon Fly Lv.140":{def:106.98,dmgred:204.6,sizeMob:"Small",raceMob:"Insect",attributeMob:"Wind"},"Eclipse Lv.140":{def:130.18,dmgred:272.8,sizeMob:"Small",raceMob:"Brute",attributeMob:"Neutral"},"Mastering Lv.140":{def:130.18,dmgred:272.8,sizeMob:"Medium",raceMob:"Plant",attributeMob:"Water"},"Ghostring Lv.140":{def:106.98,dmgred:204.6,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Ghost"},"Toad Lv.140":{def:98.97,dmgred:136.4,sizeMob:"Small",raceMob:"Fish",attributeMob:"Water"},"King Dramoh Lv.140":{def:82.47,dmgred:136.4,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Angeling Lv.140":{def:98.97,dmgred:136.4,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"},"Deviling Lv.140":{def:82.47,dmgred:136.4,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Dark Priest Lv.140":{def:212.68,dmgred:272.8,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Undead"},"Vagabond Wolf Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Medium",raceMob:"Brute",attributeMob:"Earth"},"Chimera Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Large",raceMob:"Brute",attributeMob:"Fire"},"Mysteltainn Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Large",raceMob:"Formless",attributeMob:"Shadow"},"Ogretooth Lv.140":{def:212.68,dmgred:306.35,sizeMob:"Medium",raceMob:"Formless",attributeMob:"Shadow"},"Necromancer Lv.140":{def:131.97,dmgred:150.75,sizeMob:"Medium",raceMob:"Undead",attributeMob:"Undead"},"Coelacanth Lv.140":{def:139.98,dmgred:204.6,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Naght Sieger Lv.140":{def:212.68,dmgred:272.8,sizeMob:"Large",raceMob:"Demon",attributeMob:"Ghost"},"Observation Lv.140":{def:146.68,dmgred:272.8,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Neutral"},"Skeggiold Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Small",raceMob:"Angel",attributeMob:"Holy"},"Queen Scaraba Lv.140":{def:212.3,dmgred:268.7,sizeMob:"Small",raceMob:"Insect",attributeMob:"Earth"},"Faceworm Queen Lv.140":{def:245.3,dmgred:268.7,sizeMob:"Small",raceMob:"Insect",attributeMob:"Poison"},"Ktullanux Lv.140":{def:256.5,dmgred:542.27,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Water"},"Shelter Lv.140":{def:251.18,dmgred:258,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"},"Phreeoni Lv.150":{def:136.62,dmgred:311.2,sizeMob:"Large",raceMob:"Brute",attributeMob:"Neutral"},"Mistress Lv.150":{def:161.98,dmgred:361,sizeMob:"Small",raceMob:"Insect",attributeMob:"Wind"},"Eddga Lv.150":{def:136.62,dmgred:311.2,sizeMob:"Large",raceMob:"Brute",attributeMob:"Fire"},"Kraken Lv.150":{def:161.98,dmgred:361,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Maya Lv.150":{def:118.76,dmgred:186.7,sizeMob:"Large",raceMob:"Insect",attributeMob:"Earth"},"Orc Hero Lv.150":{def:110.67,dmgred:261.4,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Pharaoh Lv.150":{def:118.76,dmgred:186.7,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Shadow"},"Orc Lord Lv.150":{def:110.67,dmgred:261.4,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Doppelganger Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Amon Ra Lv.150":{def:136.62,dmgred:311.2,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Morroc Lv.150":{def:169.17,dmgred:261.4,sizeMob:"Large",raceMob:"Demon",attributeMob:"Shadow"},"Time Holder Lv.150":{def:196.76,dmgred:186.7,sizeMob:"Large",raceMob:"Demon",attributeMob:"Neutral"},"Tao Gunka Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Large",raceMob:"Demon",attributeMob:"Neutral"},"Lost Dragon Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Shadow"},"Fallen Bishop Lv.150":{def:196.76,dmgred:186.7,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Lord of the Dead Lv.150":{def:169.17,dmgred:261.4,sizeMob:"Large",raceMob:"Demon",attributeMob:"Shadow"},"Arc Angeling Lv.150":{def:196.76,dmgred:186.7,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"},"Gioia Lv.150":{def:259.48,dmgred:361,sizeMob:"Large",raceMob:"Formless",attributeMob:"Wind"},"RSX-0806 Lv.150":{def:293.16,dmgred:317,sizeMob:"Medium",raceMob:"Formless",attributeMob:"Neutral"},"Nidhoggr's Shadow Lv.150":{def:228.13,dmgred:266,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Shadow"},"Gloom Under Night Lv.150":{def:357.57,dmgred:367,sizeMob:"Large",raceMob:"Formless",attributeMob:"Ghost"},"Retribution Lv.150":{def:299.07,dmgred:367,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Shadow"},"Dragon Fly Lv.150":{def:136.62,dmgred:311.2,sizeMob:"Small",raceMob:"Insect",attributeMob:"Wind"},"Eclipse Lv.150":{def:161.98,dmgred:361,sizeMob:"Small",raceMob:"Brute",attributeMob:"Neutral"},"Mastering Lv.150":{def:161.98,dmgred:361,sizeMob:"Medium",raceMob:"Plant",attributeMob:"Water"},"Ghostring Lv.150":{def:136.62,dmgred:311.2,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Ghost"},"Toad Lv.150":{def:118.76,dmgred:186.7,sizeMob:"Small",raceMob:"Fish",attributeMob:"Water"},"King Dramoh Lv.150":{def:110.67,dmgred:261.4,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Angeling Lv.150":{def:118.76,dmgred:186.7,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"},"Deviling Lv.150":{def:110.66,dmgred:261.4,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Dark Priest Lv.150":{def:259.48,dmgred:361,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Undead"},"Vagabond Wolf Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Medium",raceMob:"Brute",attributeMob:"Earth"},"Chimera Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Large",raceMob:"Brute",attributeMob:"Fire"},"Mysteltainn Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Large",raceMob:"Formless",attributeMob:"Shadow"},"Ogretooth Lv.150":{def:259.48,dmgred:385.89,sizeMob:"Medium",raceMob:"Formless",attributeMob:"Shadow"},"Necromancer Lv.150":{def:169.17,dmgred:272,sizeMob:"Medium",raceMob:"Undead",attributeMob:"Undead"},"Coelacanth Lv.150":{def:175.62,dmgred:311.2,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Naght Sieger Lv.150":{def:259.48,dmgred:361,sizeMob:"Large",raceMob:"Demon",attributeMob:"Ghost"},"Observation Lv.150":{def:181.48,dmgred:361,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Neutral"},"Skeggiold Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Small",raceMob:"Angel",attributeMob:"Holy"},"Queen Scaraba Lv.150":{def:258.55,dmgred:351.4,sizeMob:"Small",raceMob:"Insect",attributeMob:"Earth"},"Faceworm Queen Lv.150":{def:297.55,dmgred:351.4,sizeMob:"Small",raceMob:"Insect",attributeMob:"Poison"},"Ktullanux Lv.150":{def:299.07,dmgred:575.77,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Water"},"Shelter Lv.150":{def:293.16,dmgred:317,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"}},RACE_TYPES=["Angel","Demon","Formless","Insect","Fish","Demi-Human","Undead","Dragon","Plant","Brute"],ELEMENT_COUNTER_TABLE={Neutral:{Neutral:1,Fire:1,Water:1,Earth:1,Wind:1,Poison:1,Holy:1,Shadow:1,Ghost:.7,Undead:1},Fire:{Neutral:1,Fire:.25,Water:1,Earth:1.25,Wind:1,Poison:1,Holy:.75,Shadow:1,Ghost:1,Undead:1.125},Water:{Neutral:1,Fire:1.25,Water:.25,Earth:1,Wind:.9,Poison:1,Holy:.75,Shadow:1,Ghost:1,Undead:1},Earth:{Neutral:1,Fire:.9,Water:1,Earth:.25,Wind:1.25,Poison:1,Holy:.75,Shadow:1,Ghost:1,Undead:1},Wind:{Neutral:1,Fire:1,Water:1.375,Earth:.9,Wind:.25,Poison:1,Holy:.7,Shadow:1,Ghost:1,Undead:1},Poison:{Neutral:1,Fire:1.125,Water:1,Earth:1.125,Wind:1.125,Poison:0,Holy:.75,Shadow:.5,Ghost:1,Undead:-.25},Holy:{Neutral:1,Fire:1,Water:1,Earth:1,Wind:1,Poison:1,Holy:0,Shadow:1.375,Ghost:1,Undead:1.375},Shadow:{Neutral:1.125,Fire:1,Water:1,Earth:1,Wind:1,Poison:.5,Holy:1.375,Shadow:0,Ghost:1,Undead:-.25},Ghost:{Neutral:.9,Fire:1,Water:1,Earth:1,Wind:1,Poison:1,Holy:.75,Shadow:.75,Ghost:1.375,Undead:1},Undead:{Neutral:1,Fire:1,Water:1,Earth:1,Wind:1,Poison:.5,Holy:1.375,Shadow:0,Ghost:1.25,Undead:0}},WEAPON_SIZE_MODIFIER_TABLE={"Empty Handed":{Large:.5,Medium:.5,Small:.5},"One-Handed Sword":{Large:.75,Medium:1,Small:.75},"Two-Handed Sword":{Large:1,Medium:.75,Small:.75},"Two-Handed Spear":{Large:1,Medium:.75,Small:.75},Dagger:{Large:.75,Medium:.75,Small:1},Katar:{Large:.75,Medium:1,Small:.75},"Light Knuckle":{Large:.75,Medium:.75,Small:1},"Heavy Knuckle":{Large:1,Medium:.75,Small:.75},GS:{Large:1,Medium:1,Small:1},"Ninja Sword":{Large:1,Medium:.75,Small:.75},"Huuma Shuriken":{Large:1,Medium:1,Small:1},Tome:{Large:.75,Medium:1,Small:1},Book:{Large:1,Medium:1,Small:1},"Two-Handed Rod":{Large:1,Medium:1,Small:1},"One-Handed Rod":{Large:1,Medium:1,Small:1},Mace:{Large:1,Medium:.75,Small:.75},"One-Handed Axe":{Large:.75,Medium:.75,Small:.75},"Two-Handed Axe":{Large:.5,Medium:.75,Small:.75},Bow:{Large:.75,Medium:1,Small:1},Instrument:{Large:.75,Medium:1,Small:.75},Whip:{Large:.75,Medium:1,Small:.75}},cache={weaponSize:new Map,elementCounter:new Map,defenseData:new Map};function getWeaponSizeModifier(e=null,t=null){if("all"===e||null===e)return WEAPON_SIZE_MODIFIER_TABLE;let a=`${e}:${t}`,i=cache.weaponSize.get(a);if(void 0===i){let r=WEAPON_SIZE_MODIFIER_TABLE[e];i=r?.[t]??1,cache.weaponSize.set(a,i)}return i}function getElementCounter(e=null,t=null){if("all"===e||null===e)return ELEMENT_COUNTER_TABLE;let a=t||"Neutral",i=`${e}:${a}`,r=cache.elementCounter.get(i);if(void 0===r){let l=ELEMENT_COUNTER_TABLE[e]||ELEMENT_COUNTER_TABLE.Neutral;r=l[a]??l.Neutral??1,cache.elementCounter.set(i,r)}return r}function getTargetDefenseData(e=null){if(null===e)return DEFENSE_TABLE;let t=cache.defenseData.get(e);return void 0===t&&(t=DEFENSE_TABLE[e]||DEFENSE_TABLE["0def"],cache.defenseData.set(e,t)),t}function calculateAttackFactor(e,t,a,i=0){if("pen"===e){let r=(t||0)-(i||0);return r<=0?0:.01*(r>=150?2*r-150:r)}return"crit"===e?.01*(a||0):0}let isResultShown=!1;function calculateMultiplier(e){let{atkType:t,pen:a,crit:i,dmg:r,sizeEnh:l,elemEnh:s,race:n,attr:o,weapon:d,tSize:c,wElem:u,tAttr:m,tRace:E,tDefKey:p,extras:M={}}=e,{def:h,dmgred:b}=getTargetDefenseData(p),$=calculateAttackFactor(t,a,i,h),g=r-b,_=getWeaponSizeModifier(d,c),S=getElementCounter(u,m),f=(1+$)*(1+.01*g)*(_+.01*l)*(S+.01*s)*(1+(m?.01*o:0))*(1+(E?.01*n:0)),L={extra1:["vesper","blue3","white","dmgStack","reaperValue"],extra2:["blue8","spearValue"]},T={vesper:"Vesper",blue3:"BlueGroup3",white:"White",dmgStack:"DmgStack",reaperValue:"Reaper",blue8:"BlueGroup8",spearValue:"Spear"},v=[],N=0;L.extra1.forEach(e=>{let t=M[e]||0;if(t>0){let a=.01*t;N+=a,v.push({key:T[e],type:"extra1",value:a})}});let y=1+N,D=[],O=0;L.extra2.forEach(e=>{let t=M[e]||0;if(t>0){let a=.01*t;O+=a,D.push({key:T[e],type:"extra2",value:a})}});let w=1+O,A=[...v,...N>0?[{type:"extra1",sum:N,factor:y}]:[],...D,...O>0?[{type:"extra2",sum:O,factor:w}]:[]],k="pen"===t,I=!!(E&&n>0),C=!!(m&&o>0),F=N>0,z=O>0,R=[{key:"main",label:k?"Type (PEN)":"Type (CRIT)",val:k?a:i,mult:1+$},{key:"dmg",label:"Final P/M DMG BNS",val:r,mult:1+.01*g},{key:"elem",label:"Element",val:s,mult:S+.01*s,extra:`counter ${S}`},{key:"size",label:"Size",val:l,mult:_+.01*l,extra:`mod ${_}`},{key:"race",label:"Race",val:n,mult:1+.01*n,show:I},{key:"attr",label:"Attribute",val:o,mult:1+.01*o,show:C},{key:"extra",label:"Extra#1",val:N,mult:y,show:F},{key:"extraTwo",label:"Extra#2",val:O,mult:w,show:z}];return{mult:f*(y*w),def:h,dmgred:b,effDmgVal:g,atkF:$,sizeModifier:_,elementCounter:S,breakdownData:{factorList:R,isPenMode:k,includeRace:I,includeAttr:C,includeExtra:F,includeExtraTwo:z},parts:{baseMult:f,extraGroups:A,extra1Factor:y,extra2Factor:w,extra1Sum:N,extra2Sum:O}}}function getCurrentCalculationState(){var e,t,a,i,r,l,s;let n=e=>e&&Number(e.value)||0,o=(e=DOM_ELEMENTS.wElem)&&e.value||"",d=(t=DOM_ELEMENTS.tAttr)&&t.value||"",c=void 0!==isTestReaperActive&&isTestReaperActive,u=c?o!==d&&("Neutral"!==o||d)?14:42:0,m=void 0!==isTestSpearActive&&isTestSpearActive,E=m?42:0,p=0,M=0,h=DOM_ELEMENTS.blueSet;if(h?.selectedIndex>=0){let b=h.options[h.selectedIndex];if(b){let $=n(h),g=b.textContent||"";g.includes("*3")?p=$:g.includes("*8")&&(M=$)}}let _={atkType:(a=DOM_ELEMENTS.atkType)&&a.value||"",pen:n(DOM_ELEMENTS.pen),crit:n(DOM_ELEMENTS.crit),dmg:n(DOM_ELEMENTS.dmg),sizeEnh:n(DOM_ELEMENTS.sizeEnh),elemEnh:n(DOM_ELEMENTS.elemEnh),race:n(DOM_ELEMENTS.race),attr:n(DOM_ELEMENTS.attr),weapon:(i=DOM_ELEMENTS.weapon)&&i.value||"",tSize:(r=DOM_ELEMENTS.tSize)&&r.value||"",wElem:o,tAttr:d,tRace:(l=DOM_ELEMENTS.tRace)&&l.value||"",tDefKey:(s=DOM_ELEMENTS.tDef)&&s.value||"",vesper:n(DOM_ELEMENTS.vesperSet),white:n(DOM_ELEMENTS.whiteSet),dmgStack:n(DOM_ELEMENTS.dmgStack),blue3:p,blue8:M},S=calculateMultiplier({..._,extras:{vesper:_.vesper,white:_.white,dmgStack:_.dmgStack,blue3:_.blue3,blue8:_.blue8,reaperValue:u,spearValue:E}});return{..._,penVal:_.pen,critVal:_.crit,dmgVal:_.dmg,sizeEnhVal:_.sizeEnh,elemEnhVal:_.elemEnh,raceVal:_.race,attrVal:_.attr,tDefKey:_.tDefKey,vesperVal:_.vesper,whiteVal:_.white,dmgStackVal:_.dmgStack,blueGroup3Val:_.blue3,blueGroup8Val:_.blue8,reaperValue:u,spearValue:E,...S}}const processMainCalculation=(()=>{let e=null;return()=>{if(!validateRequiredFields()){e&&(clearTimeout(e),e=null),DOM_ELEMENTS.submit.disabled=!1,DOM_ELEMENTS.submit.textContent="Calculate";return}DOM_ELEMENTS.submit.disabled=!0,DOM_ELEMENTS.submit.textContent="Calculating...",e&&clearTimeout(e),e=setTimeout(()=>{try{let t=getCurrentCalculationState();if(!validateStatsVsTarget(t)){DOM_ELEMENTS.submit.disabled=!1,DOM_ELEMENTS.submit.textContent="Calculate";return}isResultShown=!0,lockAllInputs(),bindInputLockGuard(),renderMultiplierBreakdown(t),generateRecommendationTable(t),[DOM_ELEMENTS.testReaper,DOM_ELEMENTS.testSpear,DOM_ELEMENTS.resetRek,DOM_ELEMENTS.resetAll].forEach(e=>{e&&(e.disabled=!1)}),DOM_ELEMENTS.submit.disabled=!0,DOM_ELEMENTS.submit.textContent="Calculate"}catch(a){console.error("Calculation error:",a),DOM_ELEMENTS.submit.disabled=!1,DOM_ELEMENTS.submit.textContent="Calculate","function"==typeof showSnackbar&&showSnackbar("Calculation failed. Please check your inputs.")}finally{e=null}},300)}})();function renderMultiplierBreakdown(e){if(!isResultShown)return;let t=DOM_ELEMENTS.hasil,a=t?.dataset?.showFullPrecision==="1",i=Object.freeze({Vesper:"Vesper SET",BlueGroup3:"Blue SET (Ferocity)",White:"White SET (110*3)",DmgStack:"Final DMG BNS",Reaper:"Reaper Scythe",BlueGroup8:"Blue SET",Spear:"Divinity#1 Flash: Spear of Eternity"}),{mult:r,def:l,dmgred:s,penVal:n,critVal:o,dmgVal:d,wElem:c,tAttr:u,tSize:m,weapon:E,parts:p={},atkType:M,tRace:h,vesperVal:b,blueGroup3Val:$,blueGroup8Val:g,whiteVal:_,dmgStackVal:S,tDefKey:f,elementCounter:L,sizeModifier:T,breakdownData:v={}}=e,{extraGroups:N=[],extra1Factor:y=1,extra2Factor:D=1}=p,{factorList:O=[],isPenMode:w=!1}=v,A=a?e=>Number(e)||0:e=>parseFloat((Number(e)||0).toFixed(2)),k={extra1:{items:[],factor:y,summary:null},extra2:{items:[],factor:D,summary:null}};N.forEach(e=>{let t=e.type;!(t in k)||("sum"in e&&"factor"in e?(k[t].summary=e,k[t].factor=e.factor):"key"in e&&"value"in e?k[t].items.push(e):!("factor"in e)||"sum"in e||"key"in e||k[t].summary||(k[t].factor=e.factor))});let I=(e,t={},a=null)=>{let i=document.createElement(e);if(Object.entries(t).forEach(([e,t])=>{"class"===e?i.className=t:"text"===e?i.textContent=t:i.setAttribute(e,t)}),a){if(Array.isArray(a)){let r=document.createDocumentFragment();a.forEach(e=>{r.appendChild("string"==typeof e?document.createTextNode(e):e)}),i.appendChild(r)}else"string"==typeof a?i.textContent=a:i.appendChild(a)}return i},C={main(e){if(w){let t=n-l,a=[`Raw PEN + Final PEN: ${A(n)}`,`Target DEF: ${A(l)}`];return t>=150?a.push(`1.00 + ((( ${A(n)} - ${A(l)} ) \xd7 2 ) - 150 ) / 100`,{complex:`1.00 + ( ${A(2*t-150)} / 100 ) → `,code:`\xd7${A(e.mult)}`}):a.push({complex:`1.00 + (( ${A(n)} - ${A(l)} ) / 100 ) → `,code:`\xd7${A(e.mult)}`}),[`Attack Type: PEN vs ${f}`,a]}return[`Attack Type: CRIT vs ${f}`,[`Crit DMG: ${A(o)}`,{complex:`1.00 + ( ${A(o)} / 100 ) → `,code:`\xd7${A(e.mult)}`}]]},dmg:e=>["Final P/M Damage Bonus",[`P/M BO: ${A(d)}`,`Target Reduction: ${A(s)}`,{complex:`1.00 + (( ${A(d)} - ${A(s)} ) / 100 ) → `,code:`\xd7${A(e.mult)}`}]],elem(e){let t=[`Counter: ${A(L)}`,`${c} Enhance: ${A(e.val)}`,{complex:`${A(L)} + ${A(e.val/100)} → `,code:`\xd7${A(e.mult)}`}];return u||t.push("Tools assume target Neutral if you're not targeting any attribute."),[`Element: ${c} vs ${u||"Neutral"}`,t]},size:e=>[`Size: ${E} vs ${m}`,[`Modifier: ${A(T)}`,`${m} Enhance: ${A(e.val)}`,{complex:`${A(T)} + ${A(e.val/100)} → `,code:`\xd7${A(e.mult)}`}]],race:e=>[`Race: ${h}`,[`DMG to ${h}: ${A(e.val)}`,{complex:`1.00 + ( ${A(e.val)} / 100 ) → `,code:`\xd7${A(e.mult)}`}]],attr:e=>[`Attribute: ${u}`,[`DMG to ${u} Attribute: ${A(e.val)}`,{complex:`1.00 + ( ${A(e.val)} / 100 ) → `,code:`\xd7${A(e.mult)}`}]],extra(e){let t=[],a=k.extra1;a.items.forEach(e=>{let a=i[e.key]||e.key;if("Reaper"===e.key)t.push(`${a}: ${c} vs ${u||"Neutral"}`,`${A(100*e.value)} / 100`),t.push({note:c&&u&&c===u||"Neutral"===c&&!u?"Elements match. Real bonus is 84% (10s duration / 20s CD), displayed here as(sume) 42% for 100% uptime.":"Elements differ. Real bonus is 28% (10s duration / 20s CD), displayed here as(sume) 14% for 100% uptime."});else{let r="Vesper"===e.key&&b?`${a}: ${b}`:"BlueGroup3"===e.key&&$?`${a}: ${$}`:"White"===e.key&&_?`${a}: ${_}`:`${a}: ${A(100*e.value)}`;t.push(r,`${A(100*e.value)} / 100`)}});let r=a.summary?.factor||a.factor,l=a.items.map(e=>A(e.value));return t.push({complex:`1 + ${l.join(" + ")} → `,code:`\xd7${A(r)}`}),["Extra#1: Final DMG Bonus",t]},extraTwo(e){let t=[],a=k.extra2;a.items.forEach(e=>{let a=i[e.key]||e.key,r="BlueGroup8"===e.key&&g?`${a}: ${g}%`:a;t.push(r,`${A(100*e.value)} / 100`),"Spear"===e.key&&t.push({note:"This bonus is shown as(sume) 100% uptime (actual bonus is 84%)."})});let r=a.summary?.factor||a.factor,l=a.items.map(e=>A(e.value));return t.push({complex:`1 + ${l.join(" + ")} → `,code:`\xd7${A(r)}`}),["Extra#2: Bonus DMG to MVP/MINI",t]}},F=e=>{if(!1===e.show)return I("li",{text:`${e.label}: \xd71.00 (no stat)`});let t=C[e.key];if(!t)return I("li",{},[`${e.label}: ${A(e.val)} → `,I("code",{text:`\xd7${A(e.mult)}`})]);let[a,i]=t(e),r=i.map(e=>"string"==typeof e?I("li",{text:e}):e.complex&&e.code?I("li",{},[e.complex,I("code",{text:e.code})]):e.note?I("li",{class:"note",text:e.note}):void 0).filter(Boolean),l=I("ul"),s=document.createDocumentFragment();return r.forEach(e=>s.appendChild(e)),l.appendChild(s),I("li",{text:a},[l])},z=(()=>{let e=I("button",{type:"button",class:"toggle-precision",text:a?"Beautify!":"Want to see?"});return e.addEventListener("click",e=>{if(e.preventDefault(),e.stopPropagation(),t?.dataset){let a="1"===t.dataset.showFullPrecision?"0":"1";t.dataset.showFullPrecision=a,renderMultiplierBreakdown(getCurrentCalculationState()),"function"==typeof showSnackbar&&showSnackbar("1"===a?"Precise numbers displayed":"Rounded numbers displayed")}}),e})(),R=dropdownManager.createSwapSelect(e,w),B=I("ul",{class:"factor-breakdown"}),x=document.createDocumentFragment();O.map(F).forEach(e=>x.appendChild(e)),B.appendChild(x);let V=O.map(e=>!1===e.show?"\xd7 1.00 (no "+e.label.toLowerCase()+")":"\xd7 "+A(e.mult)),G=[m,h,u].filter(Boolean).join(" + "),P=I("div",{id:"multiplier-breakdown",class:"multiplier-breakdown"}),W=[I("blockquote",{class:"noted"},["By default, every factor starts at \xd71.00. Numbers show how it changes with your stats.",I("br"),I("br"),"Values shown to two decimal places for readability. The final result is computed with full precision(",z,"), so it may differ slightly if you recompute using the displayed (rounded) numbers."]),B,I("hr",{class:"separ"}),I("div",{id:"swap-wrapper",class:"breakdown-swap-wrapper"},[R]),I("p",{},["Your multiplier to ",I("i",{text:`${G} (${f})`}),":"]),I("blockquote",{class:"noted"},[`1.00 ${V.join(" ")} = `,I("code",{text:`\xd7${A(r)}`}),I("br"),I("br"),"Only base multipliers! Real output depends on class, skills, buffs (vesper, blue and white stack), and more. More accurate? Just use ",I("a",{class:"job-sim",target:"_blank",href:"//discord.com/channels/784407151342256148/909016309218541568/1407521807459811328",text:"job sim!"}),I("br"),I("br"),"Avg 130, Necro, Ogre, Ktul defs less accurate than others!",I("br"),I("br"),"In the table, an upward arrow means higher than your stat, a square means roughly equal (\xb13%), and a downward means lower."])],H=document.createDocumentFragment();W.forEach(e=>H.appendChild(e)),P.appendChild(H),t.innerHTML="",t.appendChild(P)}const RECOMMENDATION_CONFIG={randomMode:"clamp",maxAttempts:500,centerScale:.25,jitter:.12,jitterStep:.025,jitterStepEvery:35,jitterMax:.5,clampMaxFraction:3.5,clampMaxAbsolute:.2,upDownThreshold:2,raceAttrCap:310,raceAttrSoloCap:250,raceAttrTol:6,smallThreshold:115,smallMin:85,smallExp:.75,ratioMin:.32,ratioMax:.64,ratioNoise:.12,bias:{main:1,dmg:.95,elem:.9,size:.9,race:.72,attr:.72},cats:[{label:"6-12%",min:1.06,max:1.12},{label:"18-24%",min:1.18,max:1.24},{label:"32-48%",min:1.32,max:1.48},{label:"64-128%",min:1.64,max:2.28}],forSmallCats:[{label:"84-168%",min:1.84,max:2.68},{label:"180-270%",min:2.8,max:3.7},{label:"320-480%",min:4.32,max:5.8},{label:"510-720%",min:6.1,max:8.2}],randomCache:{values:Array(100),index:0}};function calculateRecommendationWeights(e){let{includeRace:t,includeAttr:a,baseMain:i,baseDmg:r,baseElem:l,baseSize:s,baseRace:n,baseAttr:o}=e,d=RECOMMENDATION_CONFIG.bias,c=[i*d.main,r*d.dmg,l*d.elem,s*d.size],u=Math.max(...c,1),m=c.map(e=>e/u),E=m.reduce((e,t)=>e+t,0)||1,p=t||a?.8:1,M=1-p,h={main:m[0]/E*p,dmg:m[1]/E*p,elem:m[2]/E*p,size:m[3]/E*p,race:0,attr:0};if(t||a){let b=t?Math.max(Math.pow(n,RECOMMENDATION_CONFIG.smallExp),RECOMMENDATION_CONFIG.smallMin):0,$=a?Math.max(Math.pow(o,RECOMMENDATION_CONFIG.smallExp),RECOMMENDATION_CONFIG.smallMin):0,g=t&&b>0&&b<RECOMMENDATION_CONFIG.raceAttrCap,_=a&&$>0&&$<RECOMMENDATION_CONFIG.raceAttrCap;if(g&&_){let S=b+$;h.race=b/S*M,h.attr=$/S*M}else if(g)h.race=M;else if(_)h.attr=M;else{let f=.25*M;h.main+=f,h.dmg+=f,h.elem+=f,h.size+=f}}let L=Object.values(h).reduce((e,t)=>e+t,0)||1;return Object.keys(h).forEach(e=>{h[e]/=L}),h}function generateRecommendationTable(e){if(!isResultShown)return;let t=()=>{if(RECOMMENDATION_CONFIG.randomCache.index>=RECOMMENDATION_CONFIG.randomCache.values.length){for(let e=0;e<100;e++)RECOMMENDATION_CONFIG.randomCache.values[e]=Math.random();RECOMMENDATION_CONFIG.randomCache.index=0}return RECOMMENDATION_CONFIG.randomCache.values[RECOMMENDATION_CONFIG.randomCache.index++]},a=(e,a=RECOMMENDATION_CONFIG.jitter)=>{let i=RECOMMENDATION_CONFIG.randomMode;if("clamp"===i){let r=(2*t()-1)*a,l=Math.min(RECOMMENDATION_CONFIG.clampMaxFraction*a,RECOMMENDATION_CONFIG.clampMaxAbsolute);return Math.max(0,e*(1+Math.max(Math.min(r,l),-l)))}if("normal"===i){let s=0,n=0;for(;0===s;)s=t();for(;0===n;)n=t();let o=Math.sqrt(-2*Math.log(s))*Math.cos(2*Math.PI*n);return Math.max(0,e*(1+o*a*.5))}let d=(2*t()-1)*a;return Math.max(0,e*(1+d))},i=(e,t,a)=>{let i=t+a,r=i>0&&i<RECOMMENDATION_CONFIG.smallThreshold;return r?Math.max(Math.pow(e,RECOMMENDATION_CONFIG.smallExp),RECOMMENDATION_CONFIG.smallMin):e},r=(e,t,a,i)=>e>=t?i?t+a:e+a:t,l=(e,a)=>{if(e<a)return e;let i=a*(.01+.02*t());return a-i},s=e=>{let t=Math.round(e);return t%10==0?t+1:t},n=(e,t)=>{let a=Math.round(+e||0)-Math.round(+t||0);return a>=RECOMMENDATION_CONFIG.upDownThreshold?"up":a<=-RECOMMENDATION_CONFIG.upDownThreshold?"down":"neutral"},o=+e.mult||1,d=DOM_ELEMENTS.rec;d.innerHTML="";let c=!!e.tRace&&(+e.raceVal||0)>0,u=!!e.tAttr&&(+e.attrVal||0)>0,m="pen"===e.atkType,E={main:m?+e.penVal||0:+e.critVal||0,dmg:+e.dmgVal||0,size:+e.sizeEnhVal||0,elem:+e.elemEnhVal||0,attr:u&&+e.attrVal||0,race:c&&+e.raceVal||0},p=calculateRecommendationWeights({includeRace:c,includeAttr:u,baseMain:E.main,baseDmg:E.dmg,baseElem:E.elem,baseSize:E.size,baseRace:E.race,baseAttr:E.attr}),M=RECOMMENDATION_CONFIG.centerScale,h={main:E.main*(1+p.main*M),dmg:E.dmg*(1+p.dmg*M),elem:E.elem*(1+p.elem*M),size:E.size*(1+p.size*M)},b=c?i(E.race,E.race,E.attr):0,$=u?i(E.attr,E.race,E.attr):0;c&&(p.race,RECOMMENDATION_CONFIG.raceAttrCap),u&&(p.attr,RECOMMENDATION_CONFIG.raceAttrCap);let g={blue3:+e.blueGroup3Val||0,blue8:+e.blueGroup8Val||0,vesper:+e.vesperVal||0,white:+e.whiteVal||0,dmgStack:+e.dmgStackVal||0,reaperValue:+e.reaperValue||0,spearValue:+e.spearValue||0},_=e=>{let i=0,s=0;if(u&&c){let n=E.race+E.attr,o=n>0&&n<RECOMMENDATION_CONFIG.smallThreshold,d=r(n,RECOMMENDATION_CONFIG.raceAttrCap,RECOMMENDATION_CONFIG.raceAttrTol,o),m=l(Math.min(a(b+$,e),d),d),p=RECOMMENDATION_CONFIG.ratioMin+t()*(RECOMMENDATION_CONFIG.ratioMax-RECOMMENDATION_CONFIG.ratioMin);i=m*p,s=m*(1-p);let M=i+s;if(M>d){let h=l(d,d)/M;i*=h,s*=h}}else if(c||u){let g=c?E.race:E.attr,_=g>0&&g<RECOMMENDATION_CONFIG.smallThreshold,S=r(g,RECOMMENDATION_CONFIG.raceAttrSoloCap,RECOMMENDATION_CONFIG.raceAttrTol,_),f=l(Math.min(a(c?b:$,e),S),S);c?i=f:s=f}return{raceValue:i,attrValue:s}},S=t=>{let i={pen:+e.penVal||0,crit:+e.critVal||0,dmg:a(h.dmg,t),elem:a(h.elem,t),size:a(h.size,t)};m?i.pen=a(h.main,t):i.crit=a(h.main,t);let{raceValue:r,attrValue:l}=_(t),{mult:n}=calculateMultiplier({atkType:m?"pen":"crit",pen:+i.pen||0,crit:+i.crit||0,dmg:+i.dmg||0,sizeEnh:+i.size||0,elemEnh:+i.elem||0,race:+r||0,attr:+l||0,weapon:e.weapon||"",tSize:e.tSize||"",wElem:e.wElem||"",tAttr:e.tAttr||"",tRace:e.tRace||"",tDefKey:e.tDefKey||"",extras:g});return{mainVal:s(m?i.pen:i.crit),dmgVal:s(i.dmg),elemVal:s(i.elem),sizeVal:s(i.size),raceVal:c?s(r):null,attrVal:u?s(l):null,newMultiplier:n}},f=c&&u&&E.race+E.attr>0&&E.race+E.attr<RECOMMENDATION_CONFIG.smallThreshold,L=f?RECOMMENDATION_CONFIG.forSmallCats:RECOMMENDATION_CONFIG.cats,T=["STAT",m?"PEN":"CRIT","P/M BO","Element","Size"];c&&T.push("Race"),u&&T.push("Attribute"),T.push("Multiplier","Δ");let v=[];for(let N of L){let y=new Set,D=new Set,O={main:new Set,dmg:new Set,elem:new Set,size:new Set,attr:new Set,race:new Set},w=[],A=0,k=RECOMMENDATION_CONFIG.jitter;for(;w.length<5&&A<RECOMMENDATION_CONFIG.maxAttempts;){A++;let I=S(k);if(I.newMultiplier<=o)continue;let C=I.newMultiplier/o;if(C<N.min||C>N.max)continue;let F=`${I.mainVal}|${I.dmgVal}|${I.elemVal}|${I.sizeVal}|${I.raceVal||"-"}|${I.attrVal||"-"}`;if(y.has(F)||O.main.has(I.mainVal)||O.dmg.has(I.dmgVal)||O.elem.has(I.elemVal)||O.size.has(I.sizeVal)||u&&O.attr.has(I.attrVal)||c&&O.race.has(I.raceVal)||I.mainVal>E.main&&I.dmgVal>E.dmg&&I.elemVal>E.elem&&I.sizeVal>E.size&&(!c||I.raceVal>E.race)&&(!u||I.attrVal>E.attr))continue;let z=(I.newMultiplier-o)/o*100,R=Number(z.toFixed(1));!D.has(R)&&(y.add(F),D.add(R),O.main.add(I.mainVal),O.dmg.add(I.dmgVal),O.elem.add(I.elemVal),O.size.add(I.sizeVal),u&&O.attr.add(I.attrVal),c&&O.race.add(I.raceVal),w.push({main:I.mainVal,dmg:I.dmgVal,elem:I.elemVal,size:I.sizeVal,attr:I.attrVal,race:I.raceVal,newMultiplier:I.newMultiplier,deltaPercent:z}),w.length<5&&A%RECOMMENDATION_CONFIG.jitterStepEvery==0&&(k=Math.min(k+RECOMMENDATION_CONFIG.jitterStep,RECOMMENDATION_CONFIG.jitterMax)))}if(0===w.length)continue;w.sort((e,t)=>t.deltaPercent!==e.deltaPercent?t.deltaPercent-e.deltaPercent:t.newMultiplier!==e.newMultiplier?t.newMultiplier-e.newMultiplier:t.main-e.main);let B=document.createElement("table");B.className="recommend-table",B.innerHTML=`<caption>Increase ${N.label}</caption>`;let x=document.createElement("tr");x.innerHTML=T.map(e=>`<th>${e}</th>`).join(""),B.appendChild(x);let V=document.createElement("tbody");for(let G=0;G<w.length;G++){let P=w[G],W=document.createElement("tr"),H=`<td class="build">BUILD#${G+1}</td>`;H+=`<td><span class="${n(P.main,E.main)}">${P.main}</span></td>`,H+=`<td><span class="${n(P.dmg,E.dmg)}">${P.dmg}</span></td>`,H+=`<td><span class="${n(P.elem,E.elem)}">${P.elem}</span></td>`,H+=`<td><span class="${n(P.size,E.size)}">${P.size}</span></td>`,c&&(H+=`<td><span class="${n(P.race,E.race)}">${P.race}</span></td>`),u&&(H+=`<td><span class="${n(P.attr,E.attr)}">${P.attr}</span></td>`),H+=`<td class="mult">x${P.newMultiplier.toFixed(2)}</td>`,H+=`<td class="delta">+${P.deltaPercent.toFixed(1)}%</td>`,W.innerHTML=H,V.appendChild(W)}let U=document.createElement("tr");U.className="your-stats-values";let q='<td class="yours-label">YOURS</td>';q+=`<td><span>${E.main}</span></td>`,q+=`<td><span>${E.dmg}</span></td>`,q+=`<td><span>${E.elem}</span></td>`,q+=`<td><span>${E.size}</span></td>`,c&&(q+=`<td><span>${E.race}</span></td>`),u&&(q+=`<td><span>${E.attr}</span></td>`),q+=`<td class="mult current-mult">x${e.mult.toFixed(2)}</td>`,q+='<td class="delta current-delta">-</td>',U.innerHTML=q,V.appendChild(U),B.appendChild(V);let K=document.createElement("div");K.className="table-wrapper",K.appendChild(B),v.push(K)}for(let Y of v)d.appendChild(Y)}function regenerateRecommendations(){if(!isResultShown)return;let e=getCurrentCalculationState();generateRecommendationTable(e)}let isTestReaperActive=!1,isTestSpearActive=!1,isFlashActive=!1,currentAnimatingWeapon=null;const isMobile=()=>window.innerWidth<480,debounceMap=new Map;function smoothDebounce(e,t,a){let i=debounceMap.get(a);i&&clearTimeout(i);let r=setTimeout(()=>{debounceMap.delete(a),e()},t);debounceMap.set(a,r)}const LIGHTNING_STYLES={flash:"lightning-flash-overlay",lightning:"lightning-icon"},TIMING={buttonCooldown:1600,flashTrigger:150,calculationDelayOn:950,calculationDelayOff:100,animationDuration:1800,emergencyCleanup:2200};function simulateFlash(e){let t=e?.currentTarget;if(!t||t.disabled)return;t.disabled=!0,setTimeout(()=>{t.disabled=!1},TIMING.buttonCooldown);let a=t===DOM_ELEMENTS.testReaper,i=a?"reaper":"spear",r=a?"spear":"reaper",l=a?isTestReaperActive:isTestSpearActive;a?(isTestReaperActive=!isTestReaperActive,t.classList.toggle("activated",isTestReaperActive)):(isTestSpearActive=!isTestSpearActive,t.classList.toggle("activated",isTestSpearActive));let s=a?isTestReaperActive:isTestSpearActive,n=!l&&s;if(n&&currentAnimatingWeapon&&currentAnimatingWeapon!==i){let o=debounceMap.get(`${r}-flash`),d=debounceMap.get(`${r}-calc`);o&&(clearTimeout(o),debounceMap.delete(`${r}-flash`)),d&&(clearTimeout(d),debounceMap.delete(`${r}-calc`))}n&&(currentAnimatingWeapon=i,setTimeout(()=>{currentAnimatingWeapon===i&&(currentAnimatingWeapon=null)},TIMING.calculationDelayOn+100)),n&&(smoothDebounce(triggerPulseFlash,TIMING.flashTrigger,`${i}-flash`),DOM_ELEMENTS.submit.textContent="Calculating...");let c=n?TIMING.calculationDelayOn:TIMING.calculationDelayOff;smoothDebounce(()=>{"function"==typeof processMainCalculation&&processMainCalculation()},c,`${i}-calc`),"function"==typeof showSnackbar&&showSnackbar(`${a?"Reaper":"Spear"} ${s?"Flash Active":"Off"}`)}function triggerPulseFlash(){isMobile()&&(isFlashActive||(isFlashActive=!0,requestAnimationFrame(()=>{let e=document.createElement("div"),t=document.createElement("div");e.className=LIGHTNING_STYLES.flash,t.className=LIGHTNING_STYLES.lightning,e.appendChild(t);try{document.body.appendChild(e)}catch(a){console.warn("Flash DOM insertion failed",a),isFlashActive=!1;return}let i=()=>{e.parentNode&&e.parentNode.removeChild(e),isFlashActive=!1};setTimeout(i,TIMING.animationDuration),setTimeout(()=>{isFlashActive&&e.parentNode&&i()},TIMING.emergencyCleanup)})))}class DropdownManager{constructor(e={}){this.constants={formKeys:["vesperSet","whiteSet","blueSet","tRace","tAttr","atkType","wElem","tSize","tDef","weapon","pen","crit"],mobMapping:{sizeMob:"tSize",raceMob:"tRace",attributeMob:"tAttr"},disableButtons:["resetAll","resetRek","testSpear","testReaper"],relatedFields:{tSize:"sizeEnh",tRace:"race",tAttr:"attr"},calcFields:["dmg","dmgStack","sizeEnh","race","attr","elemEnh"],setKeys:["blueSet","vesperSet","whiteSet"]},this.config={formKeys:this.constants.formKeys,mobMapping:this.constants.mobMapping,disableButtons:this.constants.disableButtons,relatedFields:this.constants.relatedFields,calculationFields:this.constants.calcFields,labels:{static:{blueSetLabel:"Blue SET",vesperSetLabel:"Vesper SET",whiteSetLabel:"White SET (110*3)",atkTypeLabel:"Attack Type",weaponLabel:"Weapon",wElemLabel:"Weapon Element",tSizeLabel:"Target Size",tRaceLabel:"Target Race",tAttrLabel:"Target Attribute",tDefLabel:"MVP/MINI",penLabel:"P/M PEN %",critLabel:"Critical DMG Bonus %",elemEnhLabel:"Element Enhance %",sizeLabel:"DMG to Size %",raceLabel:"Race",attrLabel:"Attribute",dmgLabel:"Final P/M Damage Bonus %",dmgStackLabel:"Extra: Final Damage Stack %"},dynamic:{vesper:{48:"BRO?!",56:"REALY?!",64:"Wake UP!",72:"STOP Dreaming!",80:"F2P DETECTED!"},white:{36:"Why?",42:"Still dreging yaa",48:"PFTTT!!",54:"Have a Nice Day!"}}},fields:{atkType:{type:"dropdown",options:[{value:"pen",label:"P/M PEN"},{value:"crit",label:"CRIT"}],placeholder:"Select Attack Type",onClear:["pen","crit"],onUpdate:"updateAttackTypeUI"},tSize:{type:"dropdown",options:["Small","Medium","Large"],placeholder:"Select Target Size"},tRace:{type:"dropdown",options:()=>RACE_TYPES,placeholder:"skip race",onClear:["race"]},tAttr:{type:"dropdown",options:()=>Object.keys(getElementCounter()),placeholder:"skip attribute",onClear:["attr"]},weapon:{type:"dropdown",options:()=>Object.keys(getWeaponSizeModifier()),placeholder:"Select Weapon Type"},wElem:{type:"dropdown",options:()=>Object.keys(getElementCounter()),placeholder:"Select Attribute"},tDef:{type:"dropdown",options:()=>Object.keys(getTargetDefenseData()),placeholder:"Select target",special:"target"},vesperSet:{type:"set",generator:"vesper"},whiteSet:{type:"set",generator:"white"},blueSet:{type:"set",generator:"blue"},race:{type:"conditional",dependsOn:"tRace",active:e=>({label:`DMG to ${e}`,placeholder:`dmg to ${e.toLowerCase()} %`}),default:{label:"Race",placeholder:"select target race first"}},attr:{type:"conditional",dependsOn:"tAttr",active:e=>({label:`DMG to ${e} Attribute`,placeholder:`dmg to ${e.toLowerCase()} attribute %`}),default:{label:"Attribute",placeholder:"select target attribute first"}},elemEnh:{type:"conditional",dependsOn:"wElem",active:e=>({label:`${e} Enhance %`,placeholder:`${e.toLowerCase()} enhance`}),default:{label:"Element Enhance %",placeholder:"select weapon attribute first"}},sizeEnh:{type:"conditional",dependsOn:"tSize",active:e=>({label:`DMG to ${e} %`,placeholder:`dmg to ${e.toLowerCase()}`}),default:{label:"DMG to Size %",placeholder:"select target size first"}},dmg:{type:"conditional",dependsOn:"atkType",active:()=>({placeholder:"final p/m damage bonus"}),default:{placeholder:"select attack type first"}},dmgStack:{type:"conditional",dependsOn:"atkType",active:()=>({placeholder:"final damage bonus/stack %"}),default:{placeholder:"select attack type first"}}},setGenerators:{vesper:()=>[{value:"",label:"skip vesper set"},...Object.entries(VESPER_SET).map(([e,t])=>({value:t,label:`Tier ${e}`}))],white:()=>[{value:"",label:"skip white set"},...Object.entries(WHITE_SET).map(([e,t])=>({value:t,label:e}))],blue:()=>[{value:"",label:"skip blue set"},...Object.entries(BLUE_SET).flatMap(([e,t])=>Object.entries(t).map(([t,a])=>({value:a,label:`Level ${t}*${e}`})))]},eventMap:{penCritSelect:"atkType",weaponSelect:"weapon",weaponElementSelect:"wElem",targetSizeSelect:"tSize",targetRaceSelect:"tRace",targetElementSelect:"tAttr"}},this.state={selectionOrder:[],lockStates:new Map,isDestroyed:!1,isSwapping:!1,updateTimer:null,listeners:new Map},this.init()}addListener(e,t,a){if(!e)return;let i=`${e.id||Math.random()}-${t}`;this.state.listeners.has(i)||(e.addEventListener(t,a,{passive:!0}),this.state.listeners.set(i,{element:e,event:t,handler:a}))}cleanup(){this.state.listeners.forEach(({element:e,event:t,handler:a})=>{e?.removeEventListener(t,a)}),this.state.listeners.clear(),clearTimeout(this.state.updateTimer)}init(){this.state.isDestroyed||(this.populateAllDropdowns(),this.bindEvents(),this.updateAll(),this.syncThreeSets())}getFormData(){return this.config.formKeys.reduce((e,t)=>{let a=DOM_ELEMENTS[t];return a&&(e[t]=a.value||"","SELECT"===a.tagName&&a.selectedOptions[0]&&(e[`${t}Text`]=a.selectedOptions[0].textContent)),e},{})}getTargetData(e){if(!e)return null;let t=getTargetDefenseData(e);return t?{...t,sizeMob:t.sizeMob||DOM_ELEMENTS.tSize?.value||"",raceMob:t.raceMob||DOM_ELEMENTS.tRace?.value||"",attributeMob:t.attributeMob||DOM_ELEMENTS.tAttr?.value||""}:null}getCurrentTarget(){let e=DOM_ELEMENTS.tDef?.value;return e?{key:e,data:this.getTargetData(e)}:null}populateAllDropdowns(){Object.entries(this.config.fields).forEach(([e,t])=>{if("dropdown"!==t.type&&"set"!==t.type)return;let a=DOM_ELEMENTS[e];if(a){if(t.generator)this.populateOptions(a,this.config.setGenerators[t.generator]());else{let i="function"==typeof t.options?t.options():t.options;this.populateOptions(a,i,t.placeholder)}}})}populateOptions(e,t,a){if(!e)return;let i=document.createDocumentFragment();if(a){let r=document.createElement("option");r.value="",r.textContent=a,i.appendChild(r)}t.forEach(e=>{let t=document.createElement("option");t.value="string"==typeof e?e:e.value,t.textContent="string"==typeof e?e:e.label,e.disabled&&(t.disabled=!0),i.appendChild(t)}),e.innerHTML="",e.appendChild(i)}setFieldState(e,t,a="",i=""){if(!e)return;e.disabled=t,e.placeholder=t?i:a;let r=e.closest(".input-wrap");r&&(r.classList.toggle("locked",t),t||r.removeAttribute("data-temp-unlocked"))}clearFields(e){for(let t=0;t<e.length;t++){let a=DOM_ELEMENTS[e[t]];a&&(a.value="")}}applyMobProperties(e,t="standard",a=null){e&&Object.entries(this.config.mobMapping).forEach(([i,r])=>{let l=DOM_ELEMENTS[r];if(!l)return;let s=e[i],n=this.shouldLock(r,s,t,a);l.value=n?s:"",l.disabled=n,this.state.lockStates.set(r,n);let o=l.closest(".input-wrap");if(o&&o.classList.toggle("locked",n),!n&&!s){let d=this.config.relatedFields[r];if(d&&DOM_ELEMENTS[d]){let c=DOM_ELEMENTS[d];c.value="";let u=c.closest(".input-wrap");u&&(u.classList.remove("locked"),u.setAttribute("data-temp-unlocked","1"))}}})}shouldLock(e,t,a,i){if(null!==i)return i;let r=DOM_ELEMENTS.tDef?.value||"";return"swap"===a?!!t:t&&!r.includes("Lvl.")}bindEvents(){this.addListener(document,"change",e=>{if(isResultShown)return;let t=this.config.eventMap[e.target.id];if(e.target===DOM_ELEMENTS.tDef){this.handleTargetChange();return}if(this.constants.setKeys.includes(e.target.id)){this.recordSelection(e.target),this.syncThreeSets(),this.scheduleUpdate();return}if(t){let a=this.config.fields[t];a?.onClear&&this.clearFields(a.onClear),a?.onUpdate==="updateAttackTypeUI"&&this.updateAttackTypeUI(),this.scheduleUpdate()}})}handleTargetChange(){if(this.state.isSwapping)return;let e=DOM_ELEMENTS.tDef?.value;if(!e)return;let t=this.getTargetData(e);t&&(this.applyMobProperties(t),this.syncBreakdownSwap(e),this.scheduleUpdate())}recordSelection(e){let t=this.getFormData(),a=this.state.selectionOrder.length>=3||t.blueSet&&(t.blueSetText||"").includes("*8");if(!e?.value){this.state.selectionOrder=this.state.selectionOrder.filter(t=>t!==e);return}this.state.selectionOrder=a?[e]:this.state.selectionOrder.includes(e)?this.state.selectionOrder:[...this.state.selectionOrder,e]}syncThreeSets(){let e=this.constants.setKeys.map(e=>DOM_ELEMENTS[e]).filter(Boolean),t=this.getFormData(),a=(t.blueSetText||"").includes("*8");e.forEach(e=>Array.from(e.options).forEach(e=>e.disabled=!1)),t.blueSet&&a?[DOM_ELEMENTS.vesperSet,DOM_ELEMENTS.whiteSet].forEach(e=>{e&&(Array.from(e.options).forEach(e=>e.disabled=!!e.value),e.value="")}):(this.state.selectionOrder.length>0&&Array.from(DOM_ELEMENTS.blueSet?.options||[]).forEach(e=>{e.value&&e.textContent.includes("*8")&&(e.disabled=!0)}),this.state.selectionOrder.length>=2&&e.filter(e=>!this.state.selectionOrder.includes(e)).forEach(e=>{Array.from(e.options).forEach(e=>e.disabled=!!e.value),e.value=""}),DOM_ELEMENTS.blueSet?.value&&DOM_ELEMENTS.blueSet.selectedOptions[0]?.disabled&&(DOM_ELEMENTS.blueSet.value="",this.state.selectionOrder=this.state.selectionOrder.filter(e=>e!==DOM_ELEMENTS.blueSet)))}updateAll(){let e=this.getFormData();this.updateStaticLabels(),this.updateDynamicLabels(e),this.updateConditionalFields(e),this.updateAttackTypeUI()}updateStaticLabels(){Object.entries(this.config.labels.static).forEach(([e,t])=>{DOM_ELEMENTS[e]&&(DOM_ELEMENTS[e].textContent=t)})}updateDynamicLabels(e){DOM_ELEMENTS.vesperSetLabel&&(DOM_ELEMENTS.vesperSetLabel.textContent=this.config.labels.dynamic.vesper[e.vesperSet]||"Vesper SET"),DOM_ELEMENTS.whiteSetLabel&&(DOM_ELEMENTS.whiteSetLabel.textContent=this.config.labels.dynamic.white[e.whiteSet]||"White SET (110*3)")}updateConditionalFields(e){Object.entries(this.config.fields).forEach(([t,a])=>{if("conditional"!==a.type)return;let i=DOM_ELEMENTS[t],r=DOM_ELEMENTS[`${t}Label`],l=e[a.dependsOn];if(!i||!a.active||!a.default)return;let s=l?a.active(l):a.default;i.disabled=!l,i.placeholder=s.placeholder,r&&s.label&&(r.textContent=s.label)})}updateAttackTypeUI(){let e=this.getFormData().atkType,t=document.querySelector(".form-group.pen-group"),a=document.querySelector(".form-group.crit-group");[t,a].forEach(e=>e?.classList.add("hidden")),"pen"===e&&t?(t.classList.remove("hidden"),this.setFieldState(DOM_ELEMENTS.pen,!1,"total converted raw pen + final pen..."),this.setFieldState(DOM_ELEMENTS.crit,!0)):"crit"===e&&a?(a.classList.remove("hidden"),this.setFieldState(DOM_ELEMENTS.crit,!1,"critical damage bonus..."),this.setFieldState(DOM_ELEMENTS.pen,!0)):(this.setFieldState(DOM_ELEMENTS.pen,!0),this.setFieldState(DOM_ELEMENTS.crit,!0))}scheduleUpdate(){clearTimeout(this.state.updateTimer),this.state.updateTimer=setTimeout(()=>{this.updateAll(),this.state.updateTimer=null},50)}determineSwapMode(e,t){if(!e||!t||t===e)return"none";let a=this.getTargetData(e),i=this.getTargetData(t);if(!a||!i)return"manual";let r=getTargetDefenseData(e)||{},l=getTargetDefenseData(t)||{},s={sizeMob:DOM_ELEMENTS.tSize?.value||"",raceMob:DOM_ELEMENTS.tRace?.value||"",attributeMob:DOM_ELEMENTS.tAttr?.value||""};for(let[n]of Object.entries(this.config.mobMapping)){let o=r[n],d=l[n],c=s[n];if(o&&d&&o!==d||!o&&d&&c&&c!==d)return"manual"}return"auto"}executeSwap(e,t,a){let i=this.determineSwapMode(this.getCurrentTarget()?.key,e);if("none"===i)return;this.state.isSwapping=!0,this.resetGlobalStates(),DOM_ELEMENTS.tDef&&(DOM_ELEMENTS.tDef.value=e),this.syncBreakdownSwap(e);let r=this.getTargetData(e);if(!r){this.state.isSwapping=!1;return}"auto"===i?(this.applyMobProperties(r,"swap"),"function"==typeof processMainCalculation&&processMainCalculation(),"function"==typeof showSnackbar&&showSnackbar("Auto calc triggered!"),this.scheduleUpdate()):(this.applyMobPropertiesForManualSwap(r),this.unlockFieldsForManualSwap(a),this.updateUIForManualSwap(t,a),this.scheduleUpdate()),this.state.isSwapping=!1}applyMobPropertiesForManualSwap(e){Object.entries(this.config.mobMapping).forEach(([t,a])=>{let i=DOM_ELEMENTS[a];if(!i)return;i.value=e[t]||"",i.disabled=!0,this.state.lockStates.set(a,!0);let r=i.closest(".input-wrap");r&&r.classList.add("locked")})}unlockFieldsForManualSwap(e){let t=[...this.config.calculationFields,e?"pen":"crit"];t.forEach(e=>{let t=DOM_ELEMENTS[e];if(!t)return;let a=t.closest(".input-wrap");a?.querySelector('input[type="number"]')&&(a.classList.remove("locked"),a.dataset.tempUnlocked="1"),t.disabled=!1}),"function"==typeof unbindInputLockGuard&&unbindInputLockGuard()}updateUIForManualSwap(e,t){DOM_ELEMENTS.submit&&(DOM_ELEMENTS.submit.disabled=!1),this.config.disableButtons.forEach(e=>{DOM_ELEMENTS[e]&&(DOM_ELEMENTS[e].disabled=!0)}),DOM_ELEMENTS.hasil&&(DOM_ELEMENTS.hasil.dataset.specificMode="0",DOM_ELEMENTS.hasil.textContent="Input your stats to see the result..."),DOM_ELEMENTS.rec&&(DOM_ELEMENTS.rec.textContent="Balancing stat recommendations for a higher output multiplier.");let a=t?DOM_ELEMENTS.pen:DOM_ELEMENTS.crit;"function"==typeof scrollAndFocusElement&&scrollAndFocusElement(a,"Target swapped - please verify stats and recalculate!"),"function"==typeof validateRequiredFields&&validateRequiredFields(),"function"==typeof validateStatsVsTarget&&validateStatsVsTarget(e)}syncBreakdownSwap(e){let t=document.querySelector("#breakdown-swap");t&&t.value!==e&&(t.value=e)}resetGlobalStates(){void 0!==isResultShown&&(isResultShown=!1),void 0!==isTestReaperActive&&(isTestReaperActive=!1),void 0!==isTestSpearActive&&(isTestSpearActive=!1),void 0!==isFlashActive&&(isFlashActive=!1),void 0!==keyboardListenersAdded&&(keyboardListenersAdded=!1),["testSpear","testReaper"].forEach(e=>{DOM_ELEMENTS[e]?.classList.remove("activated")})}createSwapSelect(e,t){let a=document.createElement("select");a.id="breakdown-swap",a.className="breakdown-swap";let i=+e.penVal,r=+e.dmgVal,l=this.getCurrentTarget()?.key,s=getTargetDefenseData(),n=Object.keys(s).map(e=>{let a=s[e],n=+(a?.def||0),o=+(a?.dmgred||0),d=this.determineSwapMode(l,e),c="auto"===d&&(r<=o||t&&i<=n),u=c?`${e} (cant auto calc)`:e;return`<option value="${e}"${c?" disabled":""}>${u}</option>`});return a.innerHTML=n.join(""),a.value=e.tDefKey||"0def",a.hasAttribute("data-dropdown-bound")||(a.onchange=()=>this.executeSwap(a.value,e,t),a.setAttribute("data-dropdown-bound","true")),a}getSelectionOrder(){return this.state.selectionOrder}destroy(){this.state.isDestroyed=!0,this.state.isSwapping=!1,this.cleanup(),this.state.selectionOrder=[],this.state.lockStates.clear()}}const dropdownManager=new DropdownManager;class ValidationSSoT{constructor(){this.INVALID_CLASS="invalid-value",this.listeners=new Map,this.touchedFields=new Set,this.snackbarCooldowns=new Set,this.isInitialized=!1,this.autoInit()}isPenOrDmg=e=>["pen","dmg"].includes(e?.id);isRelatedNumeric=e=>["race","attr"].includes(e?.id);isNumeric=e=>e?.type==="number"||e?.classList.contains("numeric-input")||this.isPenOrDmg(e)||this.isRelatedNumeric(e);isValidNumber=e=>!isNaN(+e)&&isFinite(+e);normalizeInput=e=>String(e).replace(/[^\d.,]/g,"").replace(/,/g,".").replace(/\.{2,}/g,".").replace(/^\./,"0.").replace(/\.$/,"");addListener(e,t,a){if(!e?.id)return!1;let i=`${e.id}-${t}`;return!this.listeners.has(i)&&(e.addEventListener(t,a),this.listeners.set(i,{element:e,event:t,handler:a}),!0)}removeListeners(){this.listeners.forEach(({element:e,event:t,handler:a})=>e.removeEventListener(t,a)),this.listeners.clear()}showMessage=e=>"function"==typeof showSnackbar&&showSnackbar(e);canShowSnackbar(e){return!this.snackbarCooldowns.has(e)&&(this.snackbarCooldowns.add(e),setTimeout(()=>this.snackbarCooldowns.delete(e),2e3),!0)}validateField(e,t=!1){let a=e.value?.trim()||"",i=this.isRelatedNumeric(e);if(i){let r="race"===e.id?DOM_ELEMENTS.tRace:DOM_ELEMENTS.tAttr;if(!r?.value&&!a)return{isValid:!0,reason:"related_empty"};if(r?.value&&!a)return{isValid:!1,reason:"related_required"}}if(!a)return{isValid:!1,reason:"empty"};if(this.isNumeric(e)&&!this.isValidNumber(a))return{isValid:!1,reason:"invalid_number"};let l=+a,[s,n]=[e.getAttribute("min"),e.getAttribute("max")];if(s&&l<+s){if(t&&this.canShowSnackbar(e.id)){let o=e.getAttribute("data-field-name")||e.id||"Field";this.showMessage(`${o} must be at least ${s}`)}return{isValid:!1,reason:"below_min"}}if(n&&l>+n)return t&&this.canShowSnackbar(e.id)&&this.showMessage("what are you doing?"),{isValid:!1,reason:"above_max"};if(this.isPenOrDmg(e)){let d=getTargetDefenseData(DOM_ELEMENTS.tDef?.value),c="pen"===e.id?+d?.def||0:+d?.dmgred||0;if(l<=c){if(t&&this.canShowSnackbar(e.id)){let u=(c+8).toFixed(2),m="pen"===e.id?"Final PEN":"Final P/M Bonus",E=DOM_ELEMENTS.tDef?.options?.[DOM_ELEMENTS.tDef.selectedIndex]?.textContent||"target";this.showMessage(`Need at least ${u} ${m} vs ${E}`)}return{isValid:!1,reason:"threshold_not_met"}}}return{isValid:!0}}updateFieldState=(e,t)=>{this.touchedFields.has(e.id)&&e.classList.toggle(this.INVALID_CLASS,!t)};setupField(e){let t=(t=!1)=>{let a=this.validateField(e,t);this.updateFieldState(e,a.isValid)},a=()=>{if(this.isNumeric(e)){let t=this.normalizeInput(e.value);t!==e.value&&(e.value=t)}};this.addListener(e,"focus",()=>this.touchedFields.add(e.id)),this.addListener(e,"input",()=>(a(),t(!1))),this.addListener(e,"blur",()=>t(!0)),this.addListener(e,"change",()=>t(!0))}checkReady=()=>void 0!==DOM_ELEMENTS&&DOM_ELEMENTS;init(){return!this.isInitialized&&!!this.checkReady()&&(["atkType","weapon","wElem","tDef","tSize","pen","crit","dmg","elemEnh","sizeEnh","race","attr","dmgStack"].map(e=>DOM_ELEMENTS[e]).filter(Boolean).forEach(e=>this.setupField(e)),DOM_ELEMENTS.tDef&&this.addListener(DOM_ELEMENTS.tDef,"change",()=>{[DOM_ELEMENTS.pen,DOM_ELEMENTS.dmg].filter(e=>e?.value.trim()).forEach(e=>{let t=this.validateField(e,this.canShowSnackbar(e.id));this.updateFieldState(e,t.isValid)})}),this.isInitialized=!0)}autoInit(){if("complete"===document.readyState)return this.init();let e=()=>this.init();"loading"===document.readyState&&document.addEventListener("DOMContentLoaded",e),window.addEventListener("load",e)}validateAllRequired(){let e=[{el:DOM_ELEMENTS.atkType,name:"Attack Type"},{el:DOM_ELEMENTS.weapon,name:"Weapon Type"},{el:DOM_ELEMENTS.wElem,name:"Weapon Attribute"},{el:DOM_ELEMENTS.tDef,name:"Target Boss"},{el:DOM_ELEMENTS.tSize,name:"Target Size"},{el:DOM_ELEMENTS.pen,name:"Final P M PEN %",condition:()=>DOM_ELEMENTS.atkType?.value==="pen"},{el:DOM_ELEMENTS.crit,name:"Critical DMG Bonus %",condition:()=>DOM_ELEMENTS.atkType?.value==="crit"},{el:DOM_ELEMENTS.dmg,name:"Final P M DMG Bonus %"},{el:DOM_ELEMENTS.elemEnh,name:"Element Enhance %"},{el:DOM_ELEMENTS.sizeEnh,name:"DMG to Size %"},{el:DOM_ELEMENTS.race,name:"DMG to Race %",condition:()=>DOM_ELEMENTS.race&&!DOM_ELEMENTS.race.disabled},{el:DOM_ELEMENTS.attr,name:"DMG to Attribute %",condition:()=>DOM_ELEMENTS.attr&&!DOM_ELEMENTS.attr.disabled},{el:DOM_ELEMENTS.dmgStack,name:"Final DMG Bonus %"}];for(let t of e){if(!t.el||t.condition&&!t.condition())continue;this.touchedFields.add(t.el.id);let a=this.validateField(t.el,this.canShowSnackbar(t.el.id));if(this.updateFieldState(t.el,a.isValid),!a.isValid)return"function"==typeof scrollAndFocusElement&&scrollAndFocusElement(t.el),!1}return!0}validateStats(e,t=null){let a=[..."pen"===e?.atkType?.toLowerCase()&&DOM_ELEMENTS.pen?[DOM_ELEMENTS.pen]:[],...DOM_ELEMENTS.dmg?[DOM_ELEMENTS.dmg]:[]];for(let i of a){this.touchedFields.add(i.id);let r=this.validateField(i,this.canShowSnackbar(i.id));if(this.updateFieldState(i,r.isValid),!r.isValid&&(t===i||!t))return"function"==typeof scrollAndFocusElement&&scrollAndFocusElement(i),!1}return!0}destroy(){this.removeListeners(),[this.touchedFields,this.snackbarCooldowns].forEach(e=>e.clear()),this.isInitialized=!1}}const ValidationSSoTInstance=new ValidationSSoT,normalizeNumericInput=(e,t)=>{if(!e)return;let a=ValidationSSoTInstance.normalizeInput(t??e.value);e.value=a;let i=ValidationSSoTInstance.validateField(e,ValidationSSoTInstance.isPenOrDmg(e));ValidationSSoTInstance.updateFieldState(e,i.isValid)},validateRequiredFields=()=>ValidationSSoTInstance.validateAllRequired(),validateStatsVsTarget=(e,t=null)=>ValidationSSoTInstance.validateStats(e,t),PASSIVE_SUPPORT=(()=>{let e=!1;try{let t=Object.defineProperty({},"passive",{get:()=>(e=!0,!1)});window.addEventListener("test-passive",()=>{},t),window.removeEventListener("test-passive",()=>{},t)}catch(a){}return e})(),POINTER_SUPPORT="PointerEvent"in window,opts=!!PASSIVE_SUPPORT&&{passive:!1};function showLockedInputMessage(e){let t=e?.currentTarget;if(!t?.classList?.contains("locked"))return;let a=Date.now();t._lastLockTimestamp&&a-t._lastLockTimestamp<500||(t._lastLockTimestamp=a,e?.cancelable&&(e.preventDefault(),e.stopPropagation()),(!window._lastSnackbarTime||a-window._lastSnackbarTime>3e3)&&(window._lastSnackbarTime=a,"function"==typeof showSnackbar&&showSnackbar("Your Stats Locked!")))}function bindInputLockGuard(e){if(!e?.nodeType||e.hasAttribute?.("data-lock-bound"))return;let t=POINTER_SUPPORT?[["pointerdown",showLockedInputMessage,opts]]:[["touchstart",showLockedInputMessage,opts],["click",showLockedInputMessage,!1]];t.forEach(([t,a,i])=>e.addEventListener(t,a,i)),e._lockListeners=t,e.setAttribute("data-lock-bound","1")}function unbindInputLockGuard(e){e?.nodeType&&e.hasAttribute?.("data-lock-bound")&&(e._lockListeners?.forEach(([t,a,i])=>{try{e.removeEventListener(t,a,i)}catch(r){}}),delete e._lockListeners,delete e._lastLockTimestamp,e.removeAttribute("data-lock-bound"))}function lockAllInputs(){document.querySelectorAll(".input-wrap").forEach(e=>{if(!e?.nodeType)return;let t=e.querySelectorAll("input, select, textarea");t.length&&(t.forEach(e=>e?.nodeType&&(e.disabled=!0)),e.classList.add("locked"),bindInputLockGuard(e))})}function unlockAllInputs(){document.querySelectorAll(".input-wrap").forEach(e=>{if(!e?.nodeType)return;let t=e.querySelectorAll("input, select, textarea");t.length&&(t.forEach(e=>e?.nodeType&&(e.disabled=!1)),e.classList.remove("locked"),unbindInputLockGuard(e))})}let snackbarTimer=null,keyboardListenersAdded=!1;function showSnackbar(e){let t=DOM_ELEMENTS.snackbar;if(t){if(t.textContent=e,clearTimeout(snackbarTimer),t.classList.remove("show"),t.offsetHeight,t.classList.add("show"),isMobile()&&!keyboardListenersAdded){keyboardListenersAdded=!0;let a=document.querySelector("input[type=number]");if(window.visualViewport){let i=()=>{let e=window.innerHeight-(window.visualViewport.height||window.innerHeight);t.style.bottom=`${80+e}px`};["resize","scroll"].forEach(e=>{window.visualViewport.addEventListener(e,i,{passive:!0})})}else a&&(a.addEventListener("focusin",()=>t.style.bottom="300px"),a.addEventListener("focusout",()=>t.style.bottom="16px"))}snackbarTimer=setTimeout(()=>t.classList.remove("show"),3e3)}}function scrollAndFocusElement(e,t){t&&showSnackbar(t);let a=e.getBoundingClientRect().top+window.pageYOffset-80;return window.scrollTo({top:a,behavior:"smooth"}),e.disabled||e.focus({preventScroll:!0}),!1}const TOOLTIP_CONFIG={"#dmgStackTips":"<strong>Final DMG Bonus</strong> and <strong>F. P/M DMG BONUS</strong> are two <strong>different</strong> things! Look for it in your <strong>detailed stats</strong> where it shows as <strong>Final Damage Stack</strong> or <strong>Final Damage Bonus</strong>. Make sure you don't have any buffs active. Can't find it? Just set 0.","#targetRaceTips":"Specific MVP/MINi will <strong>auto sync and lock</strong> this option. Select <strong>Avg Lvl Boss</strong> if you want to target spesific race!","#targetAttrTips":"also same with race.","#dmgRaceTips":"Unlocked when target race selected, minimum valid value is 0.","#dmgAttrTips":"same condition with dmg to race"};function createTooltip(e,t){if(!e||!t)return;let a=document.createElement("div");a.className="tooltip-wrap",a.innerHTML=t,document.body.appendChild(a);let i=!1,r=null,l=()=>{let t=e.getBoundingClientRect(),i=window.pageXOffset,r=window.pageYOffset;a.style.cssText="visibility:hidden;display:block";let l=a.offsetWidth,s=a.offsetHeight;a.style.cssText="";let n=t.left+i+t.width/2,o=window.innerWidth-l-16,d=t.top+r-s-12;d<16+r?(d=t.bottom+r+12,a.classList.add("flipped")):a.classList.remove("flipped"),a.style.transform=`translate(${Math.max(16,Math.min(n-l/2,o))}px, ${d}px)`},s=()=>{i||(clearTimeout(r),l(),i=!0,a.classList.add("show"))},n=()=>{i&&(a.classList.remove("show"),i=!1)},o=e=>{e&&(e.stopPropagation(),e.preventDefault()),i?n():s()},d=t=>{!i||e.contains(t.target)||a.contains(t.target)||n()},c=t=>{"Escape"===t.key&&i?n():("Enter"===t.key||" "===t.key)&&t.target===e&&(t.preventDefault(),o(t))},u=()=>{i&&(clearTimeout(r),r=setTimeout(l,16))};e.addEventListener("click",o),e.addEventListener("touchend",e=>{e.preventDefault(),o(e)},{passive:!1}),document.addEventListener("click",d),document.addEventListener("touchend",d,{passive:!0}),document.addEventListener("keydown",c),["resize","scroll"].forEach(e=>{window.addEventListener(e,u,{passive:!0})})}function setupTooltips(e){Object.entries(e).forEach(([e,t])=>{try{let a="string"==typeof e?document.querySelectorAll(e):e instanceof Element?[e]:[];a.forEach(e=>{e instanceof Element&&createTooltip(e,t)})}catch(i){}})}setupTooltips(TOOLTIP_CONFIG);class StickyHandler{constructor(){this.state={isActive:!1,isCollapsed:!1,isMobile:!1,animating:!1},this.config={MOBILE_BREAKPOINT:480,BUTTON_HEIGHT:56,ANIMATION_DELAY:60,TRANSITION_DURATION:300,DOM_REINJECT_DELAY:50,OBSERVER_DEBOUNCE:16,RESIZE_DEBOUNCE:100,LABEL_TRANSITION:200,TEXT_UPDATE_DELAY:200,CLEANUP_DELAY:320},this.selectors={resetRek:"resetRekomenBtn",resetAll:"resetAllBtn",swapBoss:"breakdown-swap",stickyStart:()=>DOM_ELEMENTS?.hasil,testSpear:()=>DOM_ELEMENTS?.testSpear,testReaper:()=>DOM_ELEMENTS?.testReaper},this.buttonOrder=["toggleBtn","swapBoss","testSpear","testReaper","resetRek","resetAll","backBtn"],this.textButtons=["resetRek","resetAll","testSpear","testReaper"],this.controlButtons=[{id:"toggleStickyBtn",class:"sticky-toggle",key:"toggleBtn",handler:"handleToggle"},{id:"backToHasilBtn",class:"sticky-back",key:"backBtn",handler:"handleBack"}],this.elements=new Map,this.timeouts=new Map,this.boundListeners=new Map,this.scrollRAF=null,this.observer=null,this.initialized=!1,this.init()}initElements(){this.elements.clear(),Object.entries(this.selectors).forEach(([e,t])=>{let a="function"==typeof t?t():document.getElementById(t);a&&(this.elements.set(e,a),this.storeOriginalText(a,e),"swapBoss"===e&&this.state.isActive&&this.state.isMobile&&(a.dataset.stickyPreserve="true"))}),this.createControlButtons()}storeOriginalText(e,t){this.textButtons.includes(t)&&!e.dataset.originalText&&(e.dataset.originalText=e.textContent.trim()||"")}createControlButtons(){this.controlButtons.forEach(({id:e,class:t,key:a,handler:i})=>{let r=document.getElementById(e);r||((r=document.createElement("button")).id=e,r.className=t,document.body.appendChild(r)),this.elements.set(a,r),this.bindButtonEvent(r,i)});let e=this.elements.get("toggleBtn");e&&(e.dataset.collapse="false")}bindButtonEvent(e,t){e.dataset.bound||(e.addEventListener("click",e=>this[t](e)),e.dataset.bound="true")}getOrderedButtons(){return this.buttonOrder.map(e=>this.elements.get(e)).filter(Boolean)}handleToggle=e=>{if(e.preventDefault(),this.state.animating)return;this.state.animating=!0,this.state.isCollapsed=!this.state.isCollapsed;let t=this.elements.get("toggleBtn");t&&(t.dataset.collapse=String(this.state.isCollapsed)),navigator.vibrate&&navigator.vibrate(50),this.applySticky(),this.scheduleTimeout("animationEnd",()=>{this.state.animating=!1},this.config.TRANSITION_DURATION)};handleBack=e=>{e.preventDefault();let t=this.elements.get("stickyStart");t&&t.scrollIntoView({behavior:"smooth",block:"start"})};handleScroll=()=>{this.scrollRAF||(this.scrollRAF=requestAnimationFrame(()=>{this.updateSticky(),this.scrollRAF=null}))};handleResize=()=>{this.scheduleTimeout("resize",()=>{this.updateSticky()},this.config.RESIZE_DEBOUNCE)};scheduleTimeout(e,t,a){this.clearTimeout(e),this.timeouts.set(e,setTimeout(t,a))}clearTimeout(e){let t=this.timeouts.get(e);t&&(clearTimeout(t),this.timeouts.delete(e))}clearAllTimeouts(){this.timeouts.forEach(e=>clearTimeout(e)),this.timeouts.clear()}updateMobileState(){let e=window.innerWidth<=this.config.MOBILE_BREAKPOINT,t=e!==this.state.isMobile;return this.state.isMobile=e,t}updateSticky(){let e=this.updateMobileState();if(!this.state.isMobile){(e||this.state.isActive)&&(this.state.isActive=!1,this.removeSticky());return}let t=this.elements.get("stickyStart");if(!t)return;let a=t.getBoundingClientRect(),i=a.top<=0;i!==this.state.isActive&&(this.state.isActive=i,this.state.isActive?this.applySticky():this.removeSticky())}applySticky(){let e=this.getOrderedButtons();if(0===e.length)return;let t=e[0].classList.contains("sticky");e.forEach((e,a)=>{let i=e===this.elements.get("toggleBtn"),r=this.state.isCollapsed?0:-(a*this.config.BUTTON_HEIGHT),l=this.state.isCollapsed&&!i?"0.4":"1";e.classList.contains("sticky")||e.classList.add("sticky"),e.classList.toggle("collapsed",this.state.isCollapsed),t?this.updateButtonPosition(e,r,l):this.animateButtonIn(e,a,r)});let a=t?0:this.config.TEXT_UPDATE_DELAY;this.scheduleTimeout("textUpdate",()=>{this.updateButtonText()},a)}animateButtonIn(e,t,a){e.style.cssText=`
      transform: translate3d(0, 50px, 0);
      opacity: 0;
      transition: none;
    `,this.scheduleTimeout(`buttonIn-${t}`,()=>{e.style.cssText=`
        transform: translate3d(0, ${a}px, 0);
        opacity: 1;
        transition: all 400ms cubic-bezier(0.34, 1.56, 0.64, 1);
      `},t*this.config.ANIMATION_DELAY)}updateButtonPosition(e,t,a){e.style.cssText=`
      transform: translate3d(0, ${t}px, 0);
      opacity: ${a};
    `}removeSticky(){let e=this.getOrderedButtons();0!==e.length&&(e.forEach(e=>{e.classList.contains("sticky")&&(e.style.cssText=`
          transform: translate3d(0, 0, 0);
          opacity: 0.3;
          transition: transform 300ms ease, opacity 200ms ease;
        `)}),this.scheduleTimeout("cleanup",()=>{this.cleanupSticky(e)},this.config.CLEANUP_DELAY))}cleanupSticky(e){e.forEach(e=>{e.classList.remove("sticky","collapsed"),e.style.cssText="",e.dataset.originalText&&(e.textContent=e.dataset.originalText)})}updateButtonText(){let e=this.state.isActive;this.textButtons.forEach(t=>{let a=this.elements.get(t);a&&(a.textContent=e?"":a.dataset.originalText||"")})}preserveSwapState(){let e=this.elements.get("swapBoss");if(!e||"SELECT"!==e.tagName)return null;let t=window.getComputedStyle(e),a=e.classList;return{value:e.value,transform:t.transform,opacity:t.opacity,isSticky:a.contains("sticky"),isCollapsed:a.contains("collapsed")}}restoreSwapState(e){if(!e)return;let t=this.elements.get("swapBoss");t&&"SELECT"===t.tagName&&(e.value&&(t.value=e.value),t.style.cssText=`
      transform: ${e.transform};
      opacity: ${e.opacity};
      transition: none;
    `,e.isSticky&&t.classList.add("sticky"),e.isCollapsed&&t.classList.add("collapsed"))}setupEventListeners(){let e=[{target:window,event:"scroll",handler:this.handleScroll},{target:window,event:"resize",handler:this.handleResize}];e.forEach(({target:e,event:t,handler:a})=>{let i=`${e===window?"window":"element"}-${t}`;this.boundListeners.has(i)||(e.addEventListener(t,a,{passive:!0}),this.boundListeners.set(i,{target:e,event:t,handler:a}))})}removeEventListeners(){this.boundListeners.forEach(({target:e,event:t,handler:a})=>{e.removeEventListener(t,a)}),this.boundListeners.clear()}setupDOMObserver(){"undefined"==typeof MutationObserver||this.observer||(this.observer=new MutationObserver(e=>{let t=!1;for(let a of e){for(let i of a.addedNodes)if("breakdown-swap"===i.id||1===i.nodeType&&i.querySelector&&i.querySelector("#breakdown-swap")){t=!0;break}if(t)break}if(!t){this.scheduleTimeout("observer",()=>this.updateSticky(),this.config.OBSERVER_DEBOUNCE);return}this.scheduleTimeout("observer",()=>{let e=this.preserveSwapState();this.initElements(),this.state.isMobile&&this.state.isActive?(e&&this.restoreSwapState(e),this.scheduleTimeout("domReinject",()=>{this.applySticky()},this.config.DOM_REINJECT_DELAY)):this.updateSticky()},this.config.OBSERVER_DEBOUNCE)}),this.observer.observe(document.body,{childList:!0,subtree:!0}))}init(){let e=()=>{this.initialized||(this.initElements(),this.setupEventListeners(),this.setupDOMObserver(),this.updateSticky(),this.initialized=!0)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e,{once:!0}):e()}destroy(){this.clearAllTimeouts(),this.scrollRAF&&(cancelAnimationFrame(this.scrollRAF),this.scrollRAF=null),this.removeEventListeners(),this.observer&&(this.observer.disconnect(),this.observer=null),this.elements.clear(),this.initialized=!1}static initialize(){return"undefined"==typeof window||window.stickyHandler||(window.stickyHandler=new StickyHandler),window.stickyHandler}}const stickyHandler=new StickyHandler;function clearCache(e=null){let t=confirm("Also clear calculation cache?");scrollAndFocusElement(DOM_ELEMENTS.topOfPage,t?"Stats and Cache Cleared!":"Stats Cleared!"),t&&(e?(cache[e]?.clear?.(),e in randomCache&&(randomCache[e]=Array.isArray(randomCache[e])?[]:0)):(Object.values(cache).forEach(e=>e?.clear?.()),Object.assign(randomCache,{values:[],index:0})))}function resetAllData(){if(!confirm("Reset all data and inputs?"))return;clearCache(),["input","select"].forEach(e=>{document.querySelectorAll(e).forEach(e=>e.value="")});let e=new Map([[DOM_ELEMENTS.hasil,"Input your stats to see the result..."],[DOM_ELEMENTS.rec,"Balancing stat recommendations for a higher output multiplier."]]);e.forEach((e,t)=>{t&&(t.textContent=e)});let t=new Map([[DOM_ELEMENTS.submit,{disabled:!1}],[DOM_ELEMENTS.resetRek,{disabled:!0}],[DOM_ELEMENTS.resetAll,{disabled:!0}],[DOM_ELEMENTS.testSpear,{disabled:!0}],[DOM_ELEMENTS.testReaper,{disabled:!0}]]);t.forEach((e,t)=>{t&&Object.assign(t,e)}),DOM_ELEMENTS.openLog?.classList.remove("locked"),[DOM_ELEMENTS.testSpear,DOM_ELEMENTS.testReaper].forEach(e=>{e?.classList.remove("activated")}),Object.assign(window,{isResultShown:!1,isTestReaperActive:!1,isTestSpearActive:!1,isFlashActive:!1,keyboardListenersAdded:!1}),unlockAllInputs(),unbindInputLockGuard()}!function(){let e=new Map,t=new Set,a=(e,a,i,r=!1)=>{e.addEventListener(a,i,r),t.add({element:e,event:a,handler:i,options:r})},i=()=>{t.forEach(({element:e,event:t,handler:a,options:i})=>{e.removeEventListener(t,a,i)}),t.clear()},r=(e,t,a)=>{let i=!1,r=null,l=()=>{r&&(cancelAnimationFrame(r),r=null),i=!1},s=(e,t=1)=>{Object.assign(a.style,{maxHeight:e,opacity:t.toString()})},n=t=>{if(!i){if(i=!0,l(),t)e.setAttribute("open",""),s("0px",.3),r=requestAnimationFrame(()=>{let e=a.scrollHeight+"px";s(e,1);let t=()=>{s("none",1),i=!1};a.addEventListener("transitionend",t,{once:!0})});else{let n=a.scrollHeight+"px";s(n,1),r=requestAnimationFrame(()=>{s("0px",.3);let t=()=>{e.removeAttribute("open"),i=!1};a.addEventListener("transitionend",t,{once:!0})})}}};return{animate:n,cleanup:l,get isAnimating(){return i}}},l=()=>{document.querySelectorAll("details").forEach(t=>{let i=t.querySelector("summary"),l=t.querySelector(".body");if(!i||!l||e.has(t))return;Object.assign(l.style,{transition:"max-height 320ms cubic-bezier(0.25, 0.8, 0.25, 1), opacity 320ms ease-out",overflow:"hidden",maxHeight:t.hasAttribute("open")?"none":"0px",opacity:t.hasAttribute("open")?"1":"0.3"});let s=r(t,i,l);e.set(t,s);let n=e=>{if(e.preventDefault(),s.isAnimating)return;let a=t.hasAttribute("open");s.animate(!a)};a(i,"click",n)})};l();let s=new MutationObserver(e=>{e.forEach(e=>{"childList"===e.type&&e.addedNodes.length>0&&requestAnimationFrame(l)})});s.observe(document.body,{childList:!0,subtree:!0});let n=()=>{s.disconnect(),e.forEach(e=>e.cleanup()),e.clear(),i()};a(window,"beforeunload",n),window.accordionCleanup&&window.accordionCleanup(),window.accordionCleanup=n}(),function(){let{log:e,openLog:t,closeLog:a}=DOM_ELEMENTS||{};if(!e)return;let i=e.querySelector(".modal-content, .log-content, .modal-body")||e.firstElementChild,r="cubic-bezier(0.25, 0.8, 0.25, 1)",l={modal:{display:"none",transition:`opacity 280ms ${r}, transform 280ms ${r}, backdrop-filter 280ms ${r}`,transformOrigin:"center"},content:i?{transition:`transform 280ms ${r}, opacity 280ms ${r}`}:null};Object.assign(e.style,l.modal),i&&Object.assign(i.style,l.content);let s=!1,n=null,o=null,d=new Map,c=(e,t,a,i=!1)=>{if(!e)return;let r=`${e.constructor.name}-${t}`;e.addEventListener(t,a,i),d.set(r,{element:e,event:t,handler:a,options:i})},u=()=>{d.forEach(({element:e,event:t,handler:a,options:i})=>{e.removeEventListener(t,a,i)}),d.clear()},m=()=>{n&&(cancelAnimationFrame(n),n=null),o&&(clearTimeout(o),o=null)},E=()=>{s&&(s=!1,m(),Object.assign(e.style,{opacity:"0",transform:"scale(0.96)",backdropFilter:"blur(0px)",backgroundColor:"transparent"}),i&&Object.assign(i.style,{transform:"translateY(-8px) scale(0.98)",opacity:"0.5"}),o=setTimeout(()=>{s||(e.style.display="none")},280))},p=()=>{s||(s=!0,m(),e.style.display="flex",n=requestAnimationFrame(()=>{Object.assign(e.style,{opacity:"1",transform:"scale(1)",backdropFilter:"blur(6px)",backgroundColor:"rgba(0, 0, 0, 0.3)"}),i&&Object.assign(i.style,{transform:"translateY(0) scale(1)",opacity:"1"})}))},M=e=>{e.stopPropagation(),p()},h=e=>{"Escape"===e.key&&s&&E()},b=e=>{s&&i&&!i.contains(e.target)&&e.target!==t&&E()};c(t,"click",M),c(a,"click",E),c(document,"keydown",h),c(document,"click",b);let $=()=>{m(),u()};c(window,"beforeunload",$),window.modalAnimationCleanup&&window.modalAnimationCleanup(),window.modalAnimationCleanup=$}(),function e(){if(e.bound)return;e.bound=!0;let t=new Map([[DOM_ELEMENTS.testSpear,simulateFlash],[DOM_ELEMENTS.testReaper,simulateFlash],[DOM_ELEMENTS.submit,processMainCalculation],[DOM_ELEMENTS.resetRek,()=>{regenerateRecommendations(),showSnackbar?.("Table Refreshed!")}],[DOM_ELEMENTS.resetAll,resetAllData]]);t.forEach((e,t)=>{t?.addEventListener&&(t.addEventListener("click",e),(t===DOM_ELEMENTS.testSpear||t===DOM_ELEMENTS.testReaper)&&t.classList.remove("activated"))})}();