const DOM_ELEMENTS={topOfPage:document.getElementById("top"),atkType:document.getElementById("penCritSelect"),weapon:document.getElementById("weaponSelect"),wElem:document.getElementById("weaponElementSelect"),tSize:document.getElementById("targetSizeSelect"),tRace:document.getElementById("targetRaceSelect"),tAttr:document.getElementById("targetElementSelect"),tDef:document.getElementById("targetDefSelect"),blueSet:document.getElementById("blueSet"),blueSetLabel:document.getElementById("blueSetLabel"),vesperSet:document.getElementById("vesperSet"),vesperSetLabel:document.getElementById("vesperSetLabel"),whiteSet:document.getElementById("whiteSet"),whiteSetLabel:document.getElementById("whiteSetLabel"),tDefLabel:document.getElementById("tDefLabel"),atkTypeLabel:document.getElementById("atkTypeLabel"),weaponLabel:document.getElementById("weaponLabel"),wElemLabel:document.getElementById("wElemLabel"),tSizeLabel:document.getElementById("tSizeLabel"),tRaceLabel:document.getElementById("tRaceLabel"),tAttrLabel:document.getElementById("tAttrLabel"),pen:document.getElementById("pen"),crit:document.getElementById("crit"),dmgStack:document.getElementById("dmgStack"),dmgStackTips:document.getElementById("dmgStackTips"),dmg:document.getElementById("dmg"),elemEnh:document.getElementById("elemEnhance"),sizeEnh:document.getElementById("sizeEnhance"),race:document.getElementById("race"),attr:document.getElementById("attr"),penLabel:document.getElementById("penLabel"),critLabel:document.getElementById("critLabel"),dmgLabel:document.getElementById("dmgLabel"),elemEnhLabel:document.getElementById("elemEnhLabel"),sizeEnhLabel:document.getElementById("sizeLabel"),raceLabel:document.getElementById("raceLabel"),attrLabel:document.getElementById("attrLabel"),hasil:document.getElementById("hasil"),rec:document.getElementById("recommendations"),submit:document.getElementById("submitBtn"),resetRek:document.getElementById("resetRekomenBtn"),resetAll:document.getElementById("resetAllBtn"),testSpear:document.getElementById("testSpear"),testReaper:document.getElementById("testReaper"),snackbar:document.getElementById("snackbar"),log:document.getElementById("log"),openLog:document.getElementById("openLog"),closeLog:document.getElementById("closeLog")},VESPER_SET={0:8,1:16,2:24,3:32,4:40,5:48,6:56,7:64,8:72,9:80},BLUE_SET={3:{30:5,40:7.5,50:10,60:12.5,70:15,80:17.5,90:20,100:22.5,110:25,120:27.5,130:30,140:32.5,150:35/*},8:{30:5,40:10,50:15,60:20,70:25,80:30,90:35,100:40,110:45,120:50,130:55,140:60,150:65*/}},WHITE_SET={"Tier 0":30,"Tier 1":36,"Tier 2":42,"Tier 3":48,"Tier 4":54},DEFENSE_TABLE={"Dummy (NO DEF)":{def:0,dmgred:0},"Avg. MVP Lvl.130":{def:182.27,dmgred:148.1},"Avg. MINI Lvl.130":{def:206.45,dmgred:165.52},"Avg. MVP MINI Lvl.130":{def:194.36,dmgred:156.81},"Avg. MVP Lvl.140":{def:155.32,dmgred:191.35},"Avg. MINI Lvl.140":{def:161.41,dmgred:233.48},"Avg. MVP MINI Lvl.140":{def:158.37,dmgred:212.41},"Avg. MVP Lvl.150":{def:191.03,dmgred:283.92},"Avg. MINI Lvl.150":{def:198.53,dmgred:324.23},"Avg. MVP MINI Lvl.150":{def:194.78,dmgred:304.08},"Avg. Small MVP Lv.140":{def:130.18,dmgred:272.8,sizeMob:"Small"},"Avg. Medium MVP Lv.140":{def:199.62,dmgred:195.88,sizeMob:"Medium"},"Avg. Large MVP Lv.140":{def:143.05,dmgred:184.84,sizeMob:"Large"},"Avg. Small MINI Lv.140":{def:161.12,dmgred:225.97,sizeMob:"Small"},"Avg. Medium MINI Lv.140":{def:148.23,dmgred:212.13,sizeMob:"Medium"},"Avg. Large MINI Lv.140":{def:178.61,dmgred:267.37,sizeMob:"Large"},"Avg. Small MVP Lv.150":{def:161.98,dmgred:361,sizeMob:"Small"},"Avg. Medium MVP Lv.150":{def:240.07,dmgred:273.72,sizeMob:"Medium"},"Avg. Large MVP Lv.150":{def:177.51,dmgred:282.29,sizeMob:"Large"},"Avg. Small MINI Lv.150":{def:198.01,dmgred:312.15,sizeMob:"Small"},"Avg. Medium MINI Lv.150":{def:182.88,dmgred:304.72,sizeMob:"Medium"},"Avg. Large MINI Lv.150":{def:219.08,dmgred:359.67,sizeMob:"Large"},"Phreeoni Lv.140":{def:106.98,dmgred:204.6,sizeMob:"Large",raceMob:"Brute",attributeMob:"Neutral"},"Mistress Lv.140":{def:130.18,dmgred:272.8,sizeMob:"Small",raceMob:"Insect",attributeMob:"Wind"},"Eddga Lv.140":{def:106.98,dmgred:204.6,sizeMob:"Large",raceMob:"Brute",attributeMob:"Fire"},"Kraken Lv.140":{def:130.18,dmgred:272.8,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Maya Lv.140":{def:98.97,dmgred:136.4,sizeMob:"Large",raceMob:"Insect",attributeMob:"Earth"},"Orc Hero Lv.140":{def:82.47,dmgred:136.4,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Pharaoh Lv.140":{def:98.97,dmgred:136.4,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Shadow"},"Orc Lord Lv.140":{def:82.47,dmgred:136.4,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Doppelganger Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Amon Ra Lv.140":{def:106.98,dmgred:204.6,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Morroc Lv.140":{def:131.97,dmgred:136.4,sizeMob:"Large",raceMob:"Demon",attributeMob:"Shadow"},"Time Holder Lv.140":{def:164.97,dmgred:136.4,sizeMob:"Large",raceMob:"Demon",attributeMob:"Neutral"},"Tao Gunka Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Large",raceMob:"Demon",attributeMob:"Neutral"},"Lost Dragon Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Shadow"},"Fallen Bishop Lv.140":{def:164.97,dmgred:136.4,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Lord of the Dead Lv.140":{def:131.97,dmgred:136.4,sizeMob:"Large",raceMob:"Demon",attributeMob:"Shadow"},"Arc Angeling Lv.140":{def:164.97,dmgred:136.4,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"},"Gioia Lv.140":{def:212.68,dmgred:272.8,sizeMob:"Large",raceMob:"Formless",attributeMob:"Wind"},"RSX-0806 Lv.140":{def:238.66,dmgred:202,sizeMob:"Medium",raceMob:"Formless",attributeMob:"Neutral"},"Nidhoggr's Shadow Lv.140":{def:181.21,dmgred:134,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Shadow"},"Gloom Under Night Lv.140":{def:306,dmgred:300,sizeMob:"Large",raceMob:"Formless",attributeMob:"Ghost"},"Retribution Lv.140":{def:256.5,dmgred:300,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Shadow"},"Dragon Fly Lv.140":{def:106.98,dmgred:204.6,sizeMob:"Small",raceMob:"Insect",attributeMob:"Wind"},"Eclipse Lv.140":{def:130.18,dmgred:272.8,sizeMob:"Small",raceMob:"Brute",attributeMob:"Neutral"},"Mastering Lv.140":{def:130.18,dmgred:272.8,sizeMob:"Medium",raceMob:"Plant",attributeMob:"Water"},"Ghostring Lv.140":{def:106.98,dmgred:204.6,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Ghost"},"Toad Lv.140":{def:98.97,dmgred:136.4,sizeMob:"Small",raceMob:"Fish",attributeMob:"Water"},"King Dramoh Lv.140":{def:82.47,dmgred:136.4,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Angeling Lv.140":{def:98.97,dmgred:136.4,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"},"Deviling Lv.140":{def:82.47,dmgred:136.4,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Dark Priest Lv.140":{def:212.68,dmgred:272.8,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Undead"},"Vagabond Wolf Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Medium",raceMob:"Brute",attributeMob:"Earth"},"Chimera Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Large",raceMob:"Brute",attributeMob:"Fire"},"Mysteltainn Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Large",raceMob:"Formless",attributeMob:"Shadow"},"Ogretooth Lv.140":{def:212.68,dmgred:306.35,sizeMob:"Medium",raceMob:"Formless",attributeMob:"Shadow"},"Necromancer Lv.140":{def:131.97,dmgred:150.75,sizeMob:"Medium",raceMob:"Undead",attributeMob:"Undead"},"Coelacanth Lv.140":{def:139.98,dmgred:204.6,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Naght Sieger Lv.140":{def:212.68,dmgred:272.8,sizeMob:"Large",raceMob:"Demon",attributeMob:"Ghost"},"Observation Lv.140":{def:146.68,dmgred:272.8,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Neutral"},"Skeggiold Lv.140":{def:172.98,dmgred:204.6,sizeMob:"Small",raceMob:"Angel",attributeMob:"Holy"},"Queen Scaraba Lv.140":{def:212.3,dmgred:268.7,sizeMob:"Small",raceMob:"Insect",attributeMob:"Earth"},"Faceworm Queen Lv.140":{def:245.3,dmgred:268.7,sizeMob:"Small",raceMob:"Insect",attributeMob:"Poison"},"Ktullanux Lv.140":{def:256.5,dmgred:542.27,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Water"},"Shelter Lv.140":{def:251.18,dmgred:258,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"},"Phreeoni Lv.150":{def:136.62,dmgred:311.2,sizeMob:"Large",raceMob:"Brute",attributeMob:"Neutral"},"Mistress Lv.150":{def:161.98,dmgred:361,sizeMob:"Small",raceMob:"Insect",attributeMob:"Wind"},"Eddga Lv.150":{def:136.62,dmgred:311.2,sizeMob:"Large",raceMob:"Brute",attributeMob:"Fire"},"Kraken Lv.150":{def:161.98,dmgred:361,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Maya Lv.150":{def:118.76,dmgred:186.7,sizeMob:"Large",raceMob:"Insect",attributeMob:"Earth"},"Orc Hero Lv.150":{def:110.67,dmgred:261.4,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Pharaoh Lv.150":{def:118.76,dmgred:186.7,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Shadow"},"Orc Lord Lv.150":{def:110.67,dmgred:261.4,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Doppelganger Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Amon Ra Lv.150":{def:136.62,dmgred:311.2,sizeMob:"Large",raceMob:"Demi-Human",attributeMob:"Earth"},"Morroc Lv.150":{def:169.17,dmgred:261.4,sizeMob:"Large",raceMob:"Demon",attributeMob:"Shadow"},"Time Holder Lv.150":{def:196.76,dmgred:186.7,sizeMob:"Large",raceMob:"Demon",attributeMob:"Neutral"},"Tao Gunka Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Large",raceMob:"Demon",attributeMob:"Neutral"},"Lost Dragon Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Shadow"},"Fallen Bishop Lv.150":{def:196.76,dmgred:186.7,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Lord of the Dead Lv.150":{def:169.17,dmgred:261.4,sizeMob:"Large",raceMob:"Demon",attributeMob:"Shadow"},"Arc Angeling Lv.150":{def:196.76,dmgred:186.7,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"},"Gioia Lv.150":{def:259.48,dmgred:361,sizeMob:"Large",raceMob:"Formless",attributeMob:"Wind"},"RSX-0806 Lv.150":{def:293.16,dmgred:317,sizeMob:"Medium",raceMob:"Formless",attributeMob:"Neutral"},"Nidhoggr's Shadow Lv.150":{def:228.13,dmgred:266,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Shadow"},"Gloom Under Night Lv.150":{def:357.57,dmgred:367,sizeMob:"Large",raceMob:"Formless",attributeMob:"Ghost"},"Retribution Lv.150":{def:299.07,dmgred:367,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Shadow"},"Dragon Fly Lv.150":{def:136.62,dmgred:311.2,sizeMob:"Small",raceMob:"Insect",attributeMob:"Wind"},"Eclipse Lv.150":{def:161.98,dmgred:361,sizeMob:"Small",raceMob:"Brute",attributeMob:"Neutral"},"Mastering Lv.150":{def:161.98,dmgred:361,sizeMob:"Medium",raceMob:"Plant",attributeMob:"Water"},"Ghostring Lv.150":{def:136.62,dmgred:311.2,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Ghost"},"Toad Lv.150":{def:118.76,dmgred:186.7,sizeMob:"Small",raceMob:"Fish",attributeMob:"Water"},"King Dramoh Lv.150":{def:110.67,dmgred:261.4,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Angeling Lv.150":{def:118.76,dmgred:186.7,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"},"Deviling Lv.150":{def:110.66,dmgred:261.4,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Shadow"},"Dark Priest Lv.150":{def:259.48,dmgred:361,sizeMob:"Medium",raceMob:"Demon",attributeMob:"Undead"},"Vagabond Wolf Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Medium",raceMob:"Brute",attributeMob:"Earth"},"Chimera Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Large",raceMob:"Brute",attributeMob:"Fire"},"Mysteltainn Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Large",raceMob:"Formless",attributeMob:"Shadow"},"Ogretooth Lv.150":{def:259.48,dmgred:385.89,sizeMob:"Medium",raceMob:"Formless",attributeMob:"Shadow"},"Necromancer Lv.150":{def:169.17,dmgred:272,sizeMob:"Medium",raceMob:"Undead",attributeMob:"Undead"},"Coelacanth Lv.150":{def:175.62,dmgred:311.2,sizeMob:"Large",raceMob:"Fish",attributeMob:"Water"},"Naght Sieger Lv.150":{def:259.48,dmgred:361,sizeMob:"Large",raceMob:"Demon",attributeMob:"Ghost"},"Observation Lv.150":{def:181.48,dmgred:361,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Neutral"},"Skeggiold Lv.150":{def:214.62,dmgred:311.2,sizeMob:"Small",raceMob:"Angel",attributeMob:"Holy"},"Queen Scaraba Lv.150":{def:258.55,dmgred:351.4,sizeMob:"Small",raceMob:"Insect",attributeMob:"Earth"},"Faceworm Queen Lv.150":{def:297.55,dmgred:351.4,sizeMob:"Small",raceMob:"Insect",attributeMob:"Poison"},"Ktullanux Lv.150":{def:299.07,dmgred:575.77,sizeMob:"Large",raceMob:"Dragon",attributeMob:"Water"},"Shelter Lv.150":{def:293.16,dmgred:317,sizeMob:"Medium",raceMob:"Angel",attributeMob:"Holy"}},RACE_TYPES=["Angel","Demon","Formless","Insect","Fish","Demi-Human","Undead","Dragon","Plant","Brute"],ELEMENT_COUNTER_TABLE={Neutral:{Neutral:1,Fire:1,Water:1,Earth:1,Wind:1,Poison:1,Holy:1,Shadow:1,Ghost:.7,Undead:1},Fire:{Neutral:1,Fire:.25,Water:1,Earth:1.25,Wind:1,Poison:1,Holy:.75,Shadow:1,Ghost:1,Undead:1.125},Water:{Neutral:1,Fire:1.25,Water:.25,Earth:1,Wind:.9,Poison:1,Holy:.75,Shadow:1,Ghost:1,Undead:1},Earth:{Neutral:1,Fire:.9,Water:1,Earth:.25,Wind:1.25,Poison:1,Holy:.75,Shadow:1,Ghost:1,Undead:1},Wind:{Neutral:1,Fire:1,Water:1.375,Earth:.9,Wind:.25,Poison:1,Holy:.7,Shadow:1,Ghost:1,Undead:1},Poison:{Neutral:1,Fire:1.125,Water:1,Earth:1.125,Wind:1.125,Poison:0,Holy:.75,Shadow:.5,Ghost:1,Undead:-.25},Holy:{Neutral:1,Fire:1,Water:1,Earth:1,Wind:1,Poison:1,Holy:0,Shadow:1.375,Ghost:1,Undead:1.375},Shadow:{Neutral:1.125,Fire:1,Water:1,Earth:1,Wind:1,Poison:.5,Holy:1.375,Shadow:0,Ghost:1,Undead:-.25},Ghost:{Neutral:.9,Fire:1,Water:1,Earth:1,Wind:1,Poison:1,Holy:.75,Shadow:.75,Ghost:1.375,Undead:1},Undead:{Neutral:1,Fire:1,Water:1,Earth:1,Wind:1,Poison:.5,Holy:1.375,Shadow:0,Ghost:1.25,Undead:0}},WEAPON_SIZE_MODIFIER_TABLE={"Empty Handed":{Large:.5,Medium:.5,Small:.5},"One-Handed Sword":{Large:.75,Medium:1,Small:.75},"Two-Handed Sword":{Large:1,Medium:.75,Small:.75},"Two-Handed Spear":{Large:1,Medium:.75,Small:.75},Dagger:{Large:.75,Medium:.75,Small:1},Katar:{Large:.75,Medium:1,Small:.75},"Light Knuckle":{Large:.75,Medium:.75,Small:1},"Heavy Knuckle":{Large:1,Medium:.75,Small:.75},GS:{Large:1,Medium:1,Small:1},"Ninja Sword":{Large:1,Medium:.75,Small:.75},"Huuma Shuriken":{Large:1,Medium:1,Small:1},Tome:{Large:.75,Medium:1,Small:1},Book:{Large:1,Medium:1,Small:1},"Two-Handed Rod":{Large:1,Medium:1,Small:1},"One-Handed Rod":{Large:1,Medium:1,Small:1},Mace:{Large:1,Medium:.75,Small:.75},"One-Handed Axe":{Large:.75,Medium:.75,Small:.75},"Two-Handed Axe":{Large:.5,Medium:.75,Small:.75},Bow:{Large:.75,Medium:1,Small:1},Instrument:{Large:.75,Medium:1,Small:.75},Whip:{Large:.75,Medium:1,Small:.75}},AppState=(()=>{let e={isResultShown:!1,isTestReaperActive:!1,isTestSpearActive:!1,isFlashActive:!1,keyboardListenersAdded:!1,currentAnimatingWeapon:null},t=new Set;return{get:t=>e[t],set(a,r){let l=e[a];l!==r&&(e[a]=r,t.forEach(e=>e(a,r,l)))},reset(){Object.keys(e).forEach(t=>{e[t]="boolean"!=typeof e[t]&&null})},subscribe:e=>t.add(e),unsubscribe:e=>t.delete(e)}})(),EventManager=(()=>{let e=new Map,t=0;return{add(a,r,l,i=!1){if(!a)return null;let s=++t;return a.addEventListener(r,l,i),e.set(s,{element:a,event:r,handler:l,options:i}),s},remove(t){let a=e.get(t);a&&(a.element.removeEventListener(a.event,a.handler,a.options),e.delete(t))},removeAll(){e.forEach(({element:e,event:t,handler:a,options:r})=>{e.removeEventListener(t,a,r)}),e.clear()}}})(),cache=(()=>{let e={weaponSize:new Map,elementCounter:new Map,defenseData:new Map},t=()=>{Object.keys(WEAPON_SIZE_MODIFIER_TABLE).forEach(t=>{["Small","Medium","Large"].forEach(a=>{let r=`${t}:${a}`;e.weaponSize.set(r,WEAPON_SIZE_MODIFIER_TABLE[t][a]??1)})}),Object.keys(ELEMENT_COUNTER_TABLE).forEach(t=>{Object.keys(ELEMENT_COUNTER_TABLE).forEach(a=>{let r=`${t}:${a}`;e.elementCounter.set(r,ELEMENT_COUNTER_TABLE[t]?.[a]??1)})}),Object.keys(DEFENSE_TABLE).forEach(t=>{e.defenseData.set(t,DEFENSE_TABLE[t])})};return t(),{get:(t,a)=>e[t].get(a),clear(t){t?e[t].clear():Object.values(e).forEach(e=>e.clear())},rewarm:t}})(),RandomGenerator=(()=>{let e=new Float64Array(1e3),t=0,a=()=>{for(let a=0;a<1e3;a++)e[a]=Math.random();t=0};return a(),{get:()=>(t>=1e3&&a(),e[t++]),reset:a}})(),isEmpty=e=>null==e||""===e;function getWeaponSizeModifier(e=null,t=null){if("all"===e||null===e)return WEAPON_SIZE_MODIFIER_TABLE;let a=`${e}:${t}`;return cache.get("weaponSize",a)??1}function getElementCounter(e=null,t=null){if("all"===e||null===e)return ELEMENT_COUNTER_TABLE;let a=`${e}:${t||"Neutral"}`;return cache.get("elementCounter",a)??1}function getTargetDefenseData(e=null){return null===e?DEFENSE_TABLE:cache.get("defenseData",e)||DEFENSE_TABLE["Dummy (NO DEF)"]}function calculateAttackFactor(e,t,a,r=0){if("pen"!==e&&"crit"!==e)return 0;if("crit"===e)return .01*(a||0);let l=(t||0)-(r||0);return l<=0?0:.01*(l>=150?2*l-150:l)}const EXTRA_LABELS={vesper:"Vesper",blue3:"BlueGroup3",white:"White",dmgStack:"DmgStack",reaperValue:"Reaper",blue8:"BlueGroup8",spearValue:"Spear"},EXTRA_GROUPS={extra1:["vesper","blue3","white","dmgStack","reaperValue"],extra2:["blue8","spearValue"]};function calculateMultiplier(e){let{atkType:t,pen:a,crit:r,dmg:l,sizeEnh:i,elemEnh:s,race:n,attr:o,weapon:d,tSize:c,wElem:u,tAttr:m,tRace:p,tDefKey:E,extras:M={}}=e,{def:g,dmgred:h}=getTargetDefenseData(E),b=calculateAttackFactor(t,a,r,g),$=l-h,_=getWeaponSizeModifier(d,c),S=getElementCounter(u,m),f=(1+b)*(1+.01*$)*(_+.01*i)*(S+.01*s)*(1+(m?.01*o:0))*(1+(p?.01*n:0)),L={extra1:[],extra2:[]},T=0,v=0;EXTRA_GROUPS.extra1.forEach(e=>{let t=M[e]||0;if(t<=0)return;let a=.01*t;T+=a,L.extra1.push({key:EXTRA_LABELS[e],type:"extra1",value:a})}),EXTRA_GROUPS.extra2.forEach(e=>{let t=M[e]||0;if(t<=0)return;let a=.01*t;v+=a,L.extra2.push({key:EXTRA_LABELS[e],type:"extra2",value:a})});let y=1+T,D=1+v,N=[...L.extra1,...T>0?[{type:"extra1",sum:T,factor:y}]:[],...L.extra2,...v>0?[{type:"extra2",sum:v,factor:D}]:[]],w="pen"===t,O=[{key:"main",label:w?"Type (PEN)":"Type (CRIT)",val:w?a:r,mult:1+b},{key:"dmg",label:"Final P/M DMG BNS",val:l,mult:1+.01*$},{key:"elem",label:"Element",val:s,mult:S+.01*s,extra:`counter ${S}`},{key:"size",label:"Size",val:i,mult:_+.01*i,extra:`mod ${_}`},{key:"race",label:"Race",val:n,mult:1+.01*n,show:!!(p&&n>0)},{key:"attr",label:"Attribute",val:o,mult:1+.01*o,show:!!(m&&o>0)},{key:"extra",label:"Extra#1",val:T,mult:y,show:T>0},{key:"extraTwo",label:"Extra#2",val:v,mult:D,show:v>0}];return{mult:f*(y*D),def:g,dmgred:h,effDmgVal:$,atkF:b,sizeModifier:_,elementCounter:S,breakdownData:{factorList:O,isPenMode:w,includeRace:!!(p&&n>0),includeAttr:!!(m&&o>0),includeExtra:T>0,includeExtraTwo:v>0},parts:{baseMult:f,extraGroups:N,extra1Factor:y,extra2Factor:D,extra1Sum:T,extra2Sum:v}}}function getCurrentCalculationState(){var e,t,a,r,l,i,s;let n=e=>e&&Number(e.value)||0,o=(e=DOM_ELEMENTS.wElem)&&e.value||"",d=(t=DOM_ELEMENTS.tAttr)&&t.value||"",c=AppState.get("isTestReaperActive"),u=c?o!==d&&("Neutral"!==o||d)?14:42:0,m=AppState.get("isTestSpearActive"),p=m?42:0,E=0,M=0,g=DOM_ELEMENTS.blueSet;if(g?.selectedIndex>=0){let h=g.options[g.selectedIndex];if(h){let b=n(g),$=h.textContent||"";$.includes("*3")?E=b:$.includes("*8")&&(M=b)}}let _={atkType:(a=DOM_ELEMENTS.atkType)&&a.value||"",pen:n(DOM_ELEMENTS.pen),crit:n(DOM_ELEMENTS.crit),dmg:n(DOM_ELEMENTS.dmg),sizeEnh:n(DOM_ELEMENTS.sizeEnh),elemEnh:n(DOM_ELEMENTS.elemEnh),race:n(DOM_ELEMENTS.race),attr:n(DOM_ELEMENTS.attr),weapon:(r=DOM_ELEMENTS.weapon)&&r.value||"",tSize:(l=DOM_ELEMENTS.tSize)&&l.value||"",wElem:o,tAttr:d,tRace:(i=DOM_ELEMENTS.tRace)&&i.value||"",tDefKey:(s=DOM_ELEMENTS.tDef)&&s.value||"",vesper:n(DOM_ELEMENTS.vesperSet),white:n(DOM_ELEMENTS.whiteSet),dmgStack:n(DOM_ELEMENTS.dmgStack),blue3:E,blue8:M},S=calculateMultiplier({..._,extras:{vesper:_.vesper,white:_.white,dmgStack:_.dmgStack,blue3:_.blue3,blue8:_.blue8,reaperValue:u,spearValue:p}});return{..._,penVal:_.pen,critVal:_.crit,dmgVal:_.dmg,sizeEnhVal:_.sizeEnh,elemEnhVal:_.elemEnh,raceVal:_.race,attrVal:_.attr,vesperVal:_.vesper,whiteVal:_.white,dmgStackVal:_.dmgStack,blueGroup3Val:_.blue3,blueGroup8Val:_.blue8,reaperValue:u,spearValue:p,...S}}const processMainCalculation=(()=>{let e=null;return()=>{if(!validateRequiredFields()){e&&clearTimeout(e),DOM_ELEMENTS.submit.disabled=!1,DOM_ELEMENTS.submit.textContent="Calculate";return}DOM_ELEMENTS.submit.disabled=!0,DOM_ELEMENTS.submit.textContent="Calculating...",e&&clearTimeout(e),e=setTimeout(()=>{try{let t=getCurrentCalculationState();if(!validateStatsVsTarget(t)){DOM_ELEMENTS.submit.disabled=!1,DOM_ELEMENTS.submit.textContent="Calculate";return}AppState.set("isResultShown",!0),lockAllInputs(),bindInputLockGuard(),renderMultiplierBreakdown(t),generateRecommendationTable(t),[DOM_ELEMENTS.testReaper,DOM_ELEMENTS.testSpear,DOM_ELEMENTS.resetRek,DOM_ELEMENTS.resetAll].forEach(e=>{e&&(e.disabled=!1)}),DOM_ELEMENTS.submit.disabled=!0,DOM_ELEMENTS.submit.textContent="Calculate"}catch(a){console.error("Calculation error:",a),DOM_ELEMENTS.submit.disabled=!1,DOM_ELEMENTS.submit.textContent="Calculate","function"==typeof showSnackbar&&showSnackbar("Calculation failed. Please check your inputs.")}finally{e=null}},300)}})(),ITEM_DISPLAY_LABELS={Vesper:"Vesper SET",BlueGroup3:"Blue SET (Ferocity)",White:"White SET (110*3)",DmgStack:"Final DMG BNS",Reaper:"Reaper Scythe",BlueGroup8:"Blue SET",Spear:"Divinity#1 Flash: Spear of Eternity"},el=(e,t={},a=null)=>{let r=document.createElement(e);if(Object.entries(t).forEach(([e,t])=>{"class"===e?r.className=t:"text"===e?r.textContent=t:r.setAttribute(e,t)}),a){if(Array.isArray(a)){let l=document.createDocumentFragment();a.forEach(e=>{l.appendChild("string"==typeof e?document.createTextNode(e):e)}),r.appendChild(l)}else"string"==typeof a?r.textContent=a:r.appendChild(a)}return r};function renderMultiplierBreakdown(e){if(!AppState.get("isResultShown"))return;let t=DOM_ELEMENTS.hasil,a=t?.dataset?.showFullPrecision==="1",r=a?e=>Number(e)||0:e=>parseFloat((Number(e)||0).toFixed(2)),{mult:l,def:i,dmgred:s,penVal:n,critVal:o,dmgVal:d,wElem:c,tAttr:u,tSize:m,weapon:p,parts:E={},atkType:M,tRace:g,vesperVal:h,blueGroup3Val:b,blueGroup8Val:$,whiteVal:_,dmgStackVal:S,tDefKey:f,elementCounter:L,sizeModifier:T,breakdownData:v={}}=e,{extraGroups:y=[],extra1Factor:D=1,extra2Factor:N=1}=E,{factorList:w=[],isPenMode:O=!1}=v,k={extra1:{items:[],factor:D,summary:null},extra2:{items:[],factor:N,summary:null}};y.forEach(e=>{let t=e.type;!(t in k)||("sum"in e&&"factor"in e?(k[t].summary=e,k[t].factor=e.factor):"key"in e&&"value"in e?k[t].items.push(e):!("factor"in e)||"sum"in e||"key"in e||k[t].summary||(k[t].factor=e.factor))});let A={main(e){if(O){let t=n-i,a=[`Raw PEN + Final PEN: ${r(n)}`,`Target DEF: ${r(i)}`];return t>=150?a.push(`1.00 + ((( ${r(n)} - ${r(i)} ) \xd7 2 ) - 150 ) / 100`,{complex:`1.00 + ( ${r(2*t-150)} / 100 ) → `,code:`\xd7${r(e.mult)}`}):a.push({complex:`1.00 + (( ${r(n)} - ${r(i)} ) / 100 ) → `,code:`\xd7${r(e.mult)}`}),[`Attack Type: PEN vs ${f}`,a]}return[`Attack Type: CRIT vs ${f}`,[`Crit DMG: ${r(o)}`,{complex:`1.00 + ( ${r(o)} / 100 ) → `,code:`\xd7${r(e.mult)}`}]]},dmg:e=>["Final P/M Damage Bonus",[`P/M BO: ${r(d)}`,`Target Reduction: ${r(s)}`,{complex:`1.00 + (( ${r(d)} - ${r(s)} ) / 100 ) → `,code:`\xd7${r(e.mult)}`}]],elem(e){let t=[`Counter: ${r(L)}`,`${c} Enhance: ${r(e.val)}`,{complex:`${r(L)} + ${r(e.val/100)} → `,code:`\xd7${r(e.mult)}`}];return u||t.push("Tools assume target Neutral if you're not targeting any attribute."),[`Element: ${c} vs ${u||"Neutral"}`,t]},size:e=>[`Size: ${p} vs ${m}`,[`Modifier: ${r(T)}`,`${m} Enhance: ${r(e.val)}`,{complex:`${r(T)} + ${r(e.val/100)} → `,code:`\xd7${r(e.mult)}`}]],race:e=>[`Race: ${g}`,[`DMG to ${g}: ${r(e.val)}`,{complex:`1.00 + ( ${r(e.val)} / 100 ) → `,code:`\xd7${r(e.mult)}`}]],attr:e=>[`Attribute: ${u}`,[`DMG to ${u} Attribute: ${r(e.val)}`,{complex:`1.00 + ( ${r(e.val)} / 100 ) → `,code:`\xd7${r(e.mult)}`}]],extra(e){let t=[],a=k.extra1;a.items.forEach(e=>{let a=ITEM_DISPLAY_LABELS[e.key]||e.key;if("Reaper"===e.key)t.push(`${a}: ${c} vs ${u||"Neutral"}`,`${r(100*e.value)} / 100`),t.push({note:c&&u&&c===u||"Neutral"===c&&!u?"Elements match. Real bonus is 84% (10s duration / 20s CD), displayed here as(sume) 42% for 100% uptime.":"Elements differ. Real bonus is 28% (10s duration / 20s CD), displayed here as(sume) 14% for 100% uptime."});else{let l="Vesper"===e.key&&h?`${a}: ${h}`:"BlueGroup3"===e.key&&b?`${a}: ${b}`:"White"===e.key&&_?`${a}: ${_}`:`${a}: ${r(100*e.value)}`;t.push(l,`${r(100*e.value)} / 100`)}});let l=a.summary?.factor||a.factor,i=a.items.map(e=>r(e.value));return t.push({complex:`1 + ${i.join(" + ")} → `,code:`\xd7${r(l)}`}),["Extra#1: Final DMG Bonus",t]},extraTwo(e){let t=[],a=k.extra2;a.items.forEach(e=>{let a=ITEM_DISPLAY_LABELS[e.key]||e.key,l="BlueGroup8"===e.key&&$?`${a}: ${$}%`:a;t.push(l,`${r(100*e.value)} / 100`),"Spear"===e.key&&t.push({note:"This bonus is shown as(sume) 100% uptime (actual bonus is 84%)."})});let l=a.summary?.factor||a.factor,i=a.items.map(e=>r(e.value));return t.push({complex:`1 + ${i.join(" + ")} → `,code:`\xd7${r(l)}`}),["Extra#2: Bonus DMG to MVP/MINI",t]}},I=e=>{if(!1===e.show)return el("li",{text:`${e.label}: \xd71.00 (no stat)`});let t=A[e.key];if(!t)return el("li",{},[`${e.label}: ${r(e.val)} → `,el("code",{text:`\xd7${r(e.mult)}`})]);let[a,l]=t(e),i=l.map(e=>"string"==typeof e?el("li",{text:e}):e.complex&&e.code?el("li",{},[e.complex,el("code",{text:e.code})]):e.note?el("li",{class:"note",text:e.note}):void 0).filter(Boolean),s=el("ul"),n=document.createDocumentFragment();return i.forEach(e=>n.appendChild(e)),s.appendChild(n),el("li",{text:a},[s])},C=(()=>{let e=el("button",{type:"button",class:"toggle-precision",text:a?"Beautify!":"Want to see?"});return EventManager.add(e,"click",e=>{if(e.preventDefault(),e.stopPropagation(),!t?.dataset)return;let a="1"===t.dataset.showFullPrecision?"0":"1";t.dataset.showFullPrecision=a,renderMultiplierBreakdown(getCurrentCalculationState()),"function"==typeof showSnackbar&&showSnackbar("1"===a?"Precise numbers displayed":"Rounded numbers displayed")}),e})(),R=dropdownManager.createSwapSelect(e,O),z=el("ul",{class:"factor-breakdown"}),F=document.createDocumentFragment();w.map(I).forEach(e=>F.appendChild(e)),z.appendChild(F);let B=w.map(e=>!1===e.show?"\xd7 1.00 (no "+e.label.toLowerCase()+")":"\xd7 "+r(e.mult)),x=[m,g,u].filter(Boolean).join(" + "),V=el("div",{id:"multiplier-breakdown",class:"multiplier-breakdown"}),P=[el("blockquote",{class:"noted"},["By default, every factor starts at \xd71.00. Numbers show how it changes with your stats.",el("br"),el("br"),"Values shown to two decimal places for readability. The final result is computed with full precision(",C,"), so it may differ slightly if you recompute using the displayed (rounded) numbers."]),z,el("hr",{class:"separ"}),el("div",{id:"swap-wrapper",class:"breakdown-swap-wrapper"},[R]),el("p",{},["Your multiplier to ",el("i",{text:`${x} (${f})`}),":"]),el("blockquote",{class:"noted"},[`1.00 ${B.join(" ")} = `,el("code",{text:`\xd7${r(l)}`}),el("br"),el("br"),"Only base multipliers! Real output depends on class, skills, buffs (vesper, blue and white stack), and more. More accurate? Just use ",el("a",{class:"job-sim",target:"_blank",href:"//discord.com/channels/784407151342256148/909016309218541568/1407521807459811328",text:"job sim!"}),el("br"),el("br"),"Avg 130, Necro, Ogre, Ktul defs less accurate than others!",el("br"),el("br"),"In the table, an upward arrow means higher than your stat, a square means roughly equal (\xb13%), and a downward means lower."])],G=document.createDocumentFragment();P.forEach(e=>G.appendChild(e)),V.appendChild(G),t.innerHTML="",t.appendChild(V)}const RECOMMENDATION_CONFIG={randomMode:"clamp",maxAttempts:500,centerScale:.25,jitter:.12,jitterStep:.025,jitterStepEvery:35,jitterMax:.5,clampMaxFraction:3.5,clampMaxAbsolute:.2,upDownThreshold:2,raceAttrCap:310,raceAttrSoloCap:250,raceAttrTol:6,smallThreshold:115,smallMin:85,smallExp:.75,ratioMin:.32,ratioMax:.64,ratioNoise:.12,bias:{main:1,dmg:.95,elem:.9,size:.9,race:.72,attr:.72},cats:[{label:"6-12%",min:1.06,max:1.12},{label:"18-24%",min:1.18,max:1.24},{label:"32-48%",min:1.32,max:1.48},{label:"64-128%",min:1.64,max:2.28}],forSmallCats:[{label:"84-168%",min:1.84,max:2.68},{label:"180-270%",min:2.8,max:3.7},{label:"320-480%",min:4.32,max:5.8},{label:"510-720%",min:6.1,max:8.2}]};function calculateRecommendationWeights(e){let{includeRace:t,includeAttr:a,baseMain:r,baseDmg:l,baseElem:i,baseSize:s,baseRace:n,baseAttr:o}=e,{bias:d,smallExp:c,smallMin:u,raceAttrCap:m}=RECOMMENDATION_CONFIG,p=[r*d.main,l*d.dmg,i*d.elem,s*d.size],E=Math.max(...p,1),M=p.map(e=>e/E),g=M.reduce((e,t)=>e+t,0)||1,h=t||a?.8:1,b=1-h,$={main:M[0]/g*h,dmg:M[1]/g*h,elem:M[2]/g*h,size:M[3]/g*h,race:0,attr:0};if(t||a){let _=t?Math.max(Math.pow(n,c),u):0,S=a?Math.max(Math.pow(o,c),u):0,f=t&&_>0&&_<m,L=a&&S>0&&S<m;if(f&&L){let T=_+S;$.race=_/T*b,$.attr=S/T*b}else if(f)$.race=b;else if(L)$.attr=b;else{let v=.25*b;$.main+=v,$.dmg+=v,$.elem+=v,$.size+=v}}let y=Object.values($).reduce((e,t)=>e+t,0)||1;return Object.keys($).forEach(e=>{$[e]/=y}),$}function generateRandomValue(e,t=RECOMMENDATION_CONFIG.jitter){let{randomMode:a,clampMaxFraction:r,clampMaxAbsolute:l}=RECOMMENDATION_CONFIG;if("clamp"===a){let i=(2*RandomGenerator.get()-1)*t,s=Math.min(r*t,l);return Math.max(0,e*(1+Math.max(Math.min(i,s),-s)))}if("normal"===a){let n=0,o=0;for(;0===n;)n=RandomGenerator.get();for(;0===o;)o=RandomGenerator.get();let d=Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*o);return Math.max(0,e*(1+d*t*.5))}let c=(2*RandomGenerator.get()-1)*t;return Math.max(0,e*(1+c))}function applySmallValueAdjustment(e,t,a){let{smallThreshold:r,smallExp:l,smallMin:i}=RECOMMENDATION_CONFIG,s=t+a;return s>0&&s<r?Math.max(Math.pow(e,l),i):e}function getMaxAllowedValue(e,t,a,r){return e>=t?r?t+a:e+a:t}function avoidCapLimit(e,t){if(e<t)return e;let a=t*(.01+.02*RandomGenerator.get());return t-a}function avoidRoundTen(e){let t=Math.round(e);return t%10==0?t+1:t}function getCellClass(e,t){let{upDownThreshold:a}=RECOMMENDATION_CONFIG,r=Math.round(+e||0)-Math.round(+t||0);return r>=a?"up":r<=-a?"down":"neutral"}function generateRecommendationTable(e){if(!AppState.get("isResultShown"))return;let t=+e.mult||1,a=DOM_ELEMENTS.rec;a.innerHTML="";let r=!!e.tRace&&(+e.raceVal||0)>0,l=!!e.tAttr&&(+e.attrVal||0)>0,i="pen"===e.atkType,s={main:i?+e.penVal||0:+e.critVal||0,dmg:+e.dmgVal||0,size:+e.sizeEnhVal||0,elem:+e.elemEnhVal||0,attr:l&&+e.attrVal||0,race:r&&+e.raceVal||0},n=calculateRecommendationWeights({includeRace:r,includeAttr:l,baseMain:s.main,baseDmg:s.dmg,baseElem:s.elem,baseSize:s.size,baseRace:s.race,baseAttr:s.attr}),{centerScale:o}=RECOMMENDATION_CONFIG,d={main:s.main*(1+n.main*o),dmg:s.dmg*(1+n.dmg*o),elem:s.elem*(1+n.elem*o),size:s.size*(1+n.size*o)},c=r?applySmallValueAdjustment(s.race,s.race,s.attr):0,u=l?applySmallValueAdjustment(s.attr,s.race,s.attr):0,{raceAttrCap:m}=RECOMMENDATION_CONFIG;r&&n.race,l&&n.attr;let p={blue3:+e.blueGroup3Val||0,blue8:+e.blueGroup8Val||0,vesper:+e.vesperVal||0,white:+e.whiteVal||0,dmgStack:+e.dmgStackVal||0,reaperValue:+e.reaperValue||0,spearValue:+e.spearValue||0},E=e=>{let{smallThreshold:t,raceAttrCap:a,raceAttrSoloCap:i,raceAttrTol:n,ratioMin:o,ratioMax:d}=RECOMMENDATION_CONFIG,m=0,p=0;if(l&&r){let E=s.race+s.attr,M=getMaxAllowedValue(E,a,n,E>0&&E<t),g=avoidCapLimit(Math.min(generateRandomValue(c+u,e),M),M),h=o+RandomGenerator.get()*(d-o);m=g*h,p=g*(1-h);let b=m+p;if(b>M){let $=avoidCapLimit(M,M)/b;m*=$,p*=$}}else if(r||l){let _=r?s.race:s.attr,S=getMaxAllowedValue(_,i,n,_>0&&_<t),f=avoidCapLimit(Math.min(generateRandomValue(r?c:u,e),S),S);r?m=f:p=f}return{raceValue:m,attrValue:p}},M=t=>{let a={pen:+e.penVal||0,crit:+e.critVal||0,dmg:generateRandomValue(d.dmg,t),elem:generateRandomValue(d.elem,t),size:generateRandomValue(d.size,t)};i?a.pen=generateRandomValue(d.main,t):a.crit=generateRandomValue(d.main,t);let{raceValue:s,attrValue:n}=E(t),{mult:o}=calculateMultiplier({atkType:i?"pen":"crit",pen:+a.pen||0,crit:+a.crit||0,dmg:+a.dmg||0,sizeEnh:+a.size||0,elemEnh:+a.elem||0,race:+s||0,attr:+n||0,weapon:e.weapon||"",tSize:e.tSize||"",wElem:e.wElem||"",tAttr:e.tAttr||"",tRace:e.tRace||"",tDefKey:e.tDefKey||"",extras:p});return{mainVal:avoidRoundTen(i?a.pen:a.crit),dmgVal:avoidRoundTen(a.dmg),elemVal:avoidRoundTen(a.elem),sizeVal:avoidRoundTen(a.size),raceVal:r?avoidRoundTen(s):null,attrVal:l?avoidRoundTen(n):null,newMultiplier:o}},g=r&&l&&s.race+s.attr>0&&s.race+s.attr<RECOMMENDATION_CONFIG.smallThreshold,h=g?RECOMMENDATION_CONFIG.forSmallCats:RECOMMENDATION_CONFIG.cats,b=["STAT",i?"PEN":"CRIT","P/M BO","Element","Size"];r&&b.push("Race"),l&&b.push("Attribute"),b.push("Multiplier","Δ");let $=[];for(let _ of h){let S=new Set,f=new Set,L={main:new Set,dmg:new Set,elem:new Set,size:new Set,attr:new Set,race:new Set},T=[],v=0,y=RECOMMENDATION_CONFIG.jitter;for(;T.length<5&&v<RECOMMENDATION_CONFIG.maxAttempts;){v++;let D=M(y);if(D.newMultiplier<=t)continue;let N=D.newMultiplier/t;if(N<_.min||N>_.max)continue;let w=`${D.mainVal}|${D.dmgVal}|${D.elemVal}|${D.sizeVal}|${D.raceVal||"-"}|${D.attrVal||"-"}`;if(S.has(w)||L.main.has(D.mainVal)||L.dmg.has(D.dmgVal)||L.elem.has(D.elemVal)||L.size.has(D.sizeVal)||l&&L.attr.has(D.attrVal)||r&&L.race.has(D.raceVal)||D.mainVal>s.main&&D.dmgVal>s.dmg&&D.elemVal>s.elem&&D.sizeVal>s.size&&(!r||D.raceVal>s.race)&&(!l||D.attrVal>s.attr))continue;let O=(D.newMultiplier-t)/t*100,k=Number(O.toFixed(1));!f.has(k)&&(S.add(w),f.add(k),L.main.add(D.mainVal),L.dmg.add(D.dmgVal),L.elem.add(D.elemVal),L.size.add(D.sizeVal),l&&L.attr.add(D.attrVal),r&&L.race.add(D.raceVal),T.push({main:D.mainVal,dmg:D.dmgVal,elem:D.elemVal,size:D.sizeVal,attr:D.attrVal,race:D.raceVal,newMultiplier:D.newMultiplier,deltaPercent:O}),T.length<5&&v%RECOMMENDATION_CONFIG.jitterStepEvery==0&&(y=Math.min(y+RECOMMENDATION_CONFIG.jitterStep,RECOMMENDATION_CONFIG.jitterMax)))}if(0===T.length)continue;T.sort((e,t)=>t.deltaPercent!==e.deltaPercent?t.deltaPercent-e.deltaPercent:t.newMultiplier!==e.newMultiplier?t.newMultiplier-e.newMultiplier:t.main-e.main);let A=document.createElement("table");A.className="recommend-table",A.innerHTML=`<caption>Increase ${_.label}</caption>`;let I=document.createElement("tr");I.innerHTML=b.map(e=>`<th>${e}</th>`).join(""),A.appendChild(I);let C=document.createElement("tbody");for(let R=0;R<T.length;R++){let z=T[R],F=document.createElement("tr"),B=[`<td class="build">BUILD#${R+1}</td>`,`<td><span class="${getCellClass(z.main,s.main)}">${z.main}</span></td>`,`<td><span class="${getCellClass(z.dmg,s.dmg)}">${z.dmg}</span></td>`,`<td><span class="${getCellClass(z.elem,s.elem)}">${z.elem}</span></td>`,`<td><span class="${getCellClass(z.size,s.size)}">${z.size}</span></td>`];r&&B.push(`<td><span class="${getCellClass(z.race,s.race)}">${z.race}</span></td>`),l&&B.push(`<td><span class="${getCellClass(z.attr,s.attr)}">${z.attr}</span></td>`),B.push(`<td class="mult">x${z.newMultiplier.toFixed(2)}</td>`),B.push(`<td class="delta">+${z.deltaPercent.toFixed(1)}%</td>`),F.innerHTML=B.join(""),C.appendChild(F)}let x=document.createElement("tr");x.className="your-stats-values";let V=['<td class="yours-label">YOURS</td>',`<td><span>${s.main}</span></td>`,`<td><span>${s.dmg}</span></td>`,`<td><span>${s.elem}</span></td>`,`<td><span>${s.size}</span></td>`];r&&V.push(`<td><span>${s.race}</span></td>`),l&&V.push(`<td><span>${s.attr}</span></td>`),V.push(`<td class="mult current-mult">x${e.mult.toFixed(2)}</td>`),V.push('<td class="delta current-delta">-</td>'),x.innerHTML=V.join(""),C.appendChild(x),A.appendChild(C);let P=document.createElement("div");P.className="table-wrapper",P.appendChild(A),$.push(P)}let G=document.createDocumentFragment();$.forEach(e=>G.appendChild(e)),a.appendChild(G)}function regenerateRecommendations(){if(!AppState.get("isResultShown"))return;let e=getCurrentCalculationState();generateRecommendationTable(e)}const isMobile=()=>window.innerWidth<480,debounceMap=new Map;function smoothDebounce(e,t,a){let r=debounceMap.get(a);r&&clearTimeout(r);let l=setTimeout(()=>{debounceMap.delete(a),e()},t);debounceMap.set(a,l)}const TIMING={buttonCooldown:1600,flashTrigger:150,calculationDelayOn:950,calculationDelayOff:100,animationDuration:1800,emergencyCleanup:2200};function simulateFlash(e){let t=e?.currentTarget;if(!t||t.disabled)return;t.disabled=!0,setTimeout(()=>{t.disabled=!1},TIMING.buttonCooldown);let a=t===DOM_ELEMENTS.testReaper,r=a?"reaper":"spear",l=a?"spear":"reaper",i=AppState.get(a?"isTestReaperActive":"isTestSpearActive");AppState.set(a?"isTestReaperActive":"isTestSpearActive",!i),t.classList.toggle("activated",AppState.get(a?"isTestReaperActive":"isTestSpearActive"));let s=AppState.get(a?"isTestReaperActive":"isTestSpearActive"),n=!i&&s;n&&AppState.get("currentAnimatingWeapon")&&AppState.get("currentAnimatingWeapon")!==r&&["flash","calc"].forEach(e=>{let t=`${l}-${e}`,a=debounceMap.get(t);a&&(clearTimeout(a),debounceMap.delete(t))}),n&&(AppState.set("currentAnimatingWeapon",r),setTimeout(()=>{AppState.get("currentAnimatingWeapon")===r&&AppState.set("currentAnimatingWeapon",null)},TIMING.calculationDelayOn+100)),n&&(smoothDebounce(triggerPulseFlash,TIMING.flashTrigger,`${r}-flash`),DOM_ELEMENTS.submit.textContent="Calculating...");let o=n?TIMING.calculationDelayOn:TIMING.calculationDelayOff;smoothDebounce(()=>{"function"==typeof processMainCalculation&&processMainCalculation()},o,`${r}-calc`),"function"==typeof showSnackbar&&showSnackbar(`${a?"Reaper":"Spear"} ${s?"Flash Active":"Off"}`)}function triggerPulseFlash(){!isMobile()||AppState.get("isFlashActive")||(AppState.set("isFlashActive",!0),requestAnimationFrame(()=>{let e=document.createElement("div"),t=document.createElement("div");e.className="lightning-flash-overlay",t.className="lightning-icon",e.appendChild(t);try{document.body.appendChild(e)}catch(a){console.warn("Flash DOM insertion failed",a),AppState.set("isFlashActive",!1);return}let r=()=>{e.parentNode&&e.parentNode.removeChild(e),AppState.set("isFlashActive",!1)};setTimeout(r,TIMING.animationDuration),setTimeout(()=>{AppState.get("isFlashActive")&&e.parentNode&&r()},TIMING.emergencyCleanup)}))}class DropdownManager{constructor(){this.constants={formKeys:["vesperSet","whiteSet","blueSet","tRace","tAttr","atkType","wElem","tSize","tDef","weapon","pen","crit"],mobMapping:{sizeMob:"tSize",raceMob:"tRace",attributeMob:"tAttr"},disableButtons:["resetAll","resetRek","testSpear","testReaper"],relatedFields:{tSize:"sizeEnh",tRace:"race",tAttr:"attr"},calcFields:["dmg","dmgStack","sizeEnh","race","attr","elemEnh"],setKeys:["blueSet","vesperSet","whiteSet"]},this.config=this.buildConfig(),this.state={selectionOrder:[],lockStates:new Map,isDestroyed:!1,isSwapping:!1,updateTimer:null},this.init()}buildConfig(){return{formKeys:this.constants.formKeys,mobMapping:this.constants.mobMapping,disableButtons:this.constants.disableButtons,relatedFields:this.constants.relatedFields,calculationFields:this.constants.calcFields,labels:{static:{blueSetLabel:"Blue SET",vesperSetLabel:"Vesper SET",whiteSetLabel:"White SET (110*3)",atkTypeLabel:"Attack Type",weaponLabel:"Weapon",wElemLabel:"Weapon Element",tSizeLabel:"Target Size",tRaceLabel:"Target Race",tAttrLabel:"Target Attribute",tDefLabel:"MVP/MINI",penLabel:"P/M PEN %",critLabel:"Critical DMG Bonus %",elemEnhLabel:"Element Enhance %",sizeLabel:"DMG to Size %",raceLabel:"Race",attrLabel:"Attribute",dmgLabel:"Final P/M Damage Bonus %",dmgStackLabel:"Extra: Final Damage Stack %"},dynamic:{vesper:{48:"BRO?!",56:"REALY?!",64:"Wake UP!",72:"STOP Dreaming!",80:"F2P DETECTED!"},white:{36:"Why?",42:"Still dreging yaa",48:"PFTTT!!",54:"Have a Nice Day!"}}},fields:{atkType:{type:"dropdown",options:[{value:"pen",label:"P/M PEN"},{value:"crit",label:"CRIT"}],placeholder:"Select Attack Type",onClear:["pen","crit"],onUpdate:"updateAttackTypeUI"},tSize:{type:"dropdown",options:["Small","Medium","Large"],placeholder:"Select Target Size"},tRace:{type:"dropdown",options:()=>RACE_TYPES,placeholder:"skip race",onClear:["race"]},tAttr:{type:"dropdown",options:()=>Object.keys(getElementCounter()),placeholder:"skip attribute",onClear:["attr"]},weapon:{type:"dropdown",options:()=>Object.keys(getWeaponSizeModifier()),placeholder:"Select Weapon Type"},wElem:{type:"dropdown",options:()=>Object.keys(getElementCounter()),placeholder:"Select Attribute"},tDef:{type:"dropdown",options:()=>Object.keys(getTargetDefenseData()),placeholder:"Select target",special:"target"},vesperSet:{type:"set",generator:"vesper"},whiteSet:{type:"set",generator:"white"},blueSet:{type:"set",generator:"blue"},race:{type:"conditional",dependsOn:"tRace",active:e=>({label:`DMG to ${e}`,placeholder:`dmg to ${e.toLowerCase()} %`}),default:{label:"Race",placeholder:"select target race first"}},attr:{type:"conditional",dependsOn:"tAttr",active:e=>({label:`DMG to ${e} Attribute`,placeholder:`dmg to ${e.toLowerCase()} attribute %`}),default:{label:"Attribute",placeholder:"select target attribute first"}},elemEnh:{type:"conditional",dependsOn:"wElem",active:e=>({label:`${e} Enhance %`,placeholder:`${e.toLowerCase()} enhance`}),default:{label:"Element Enhance %",placeholder:"select weapon attribute first"}},sizeEnh:{type:"conditional",dependsOn:"tSize",active:e=>({label:`DMG to ${e} %`,placeholder:`dmg to ${e.toLowerCase()}`}),default:{label:"DMG to Size %",placeholder:"select target size first"}},dmg:{type:"conditional",dependsOn:"atkType",active:()=>({placeholder:"final p/m damage bonus"}),default:{placeholder:"select attack type first"}},dmgStack:{type:"conditional",dependsOn:"atkType",active:()=>({placeholder:"final damage bonus/stack %"}),default:{placeholder:"select attack type first"}}},setGenerators:{vesper:()=>[{value:"",label:"skip vesper set"},...Object.entries(VESPER_SET).map(([e,t])=>({value:t,label:`Tier ${e}`}))],white:()=>[{value:"",label:"skip white set"},...Object.entries(WHITE_SET).map(([e,t])=>({value:t,label:e}))],blue:()=>[{value:"",label:"skip blue set"},...Object.entries(BLUE_SET).flatMap(([e,t])=>Object.entries(t).map(([t,a])=>({value:a,label:`Level ${t}*${e}`})))]},eventMap:{penCritSelect:"atkType",weaponSelect:"weapon",weaponElementSelect:"wElem",targetSizeSelect:"tSize",targetRaceSelect:"tRace",targetElementSelect:"tAttr"}}}cleanup(){clearTimeout(this.state.updateTimer)}init(){this.state.isDestroyed||(this.populateAllDropdowns(),this.bindEvents(),this.updateAll(),this.syncThreeSets())}getFormData(){return this.config.formKeys.reduce((e,t)=>{let a=DOM_ELEMENTS[t];return a&&(e[t]=a.value||"","SELECT"===a.tagName&&a.selectedOptions[0]&&(e[`${t}Text`]=a.selectedOptions[0].textContent)),e},{})}getTargetData(e){if(!e)return null;let t=getTargetDefenseData(e);return t?{...t,sizeMob:t.sizeMob||DOM_ELEMENTS.tSize?.value||"",raceMob:t.raceMob||DOM_ELEMENTS.tRace?.value||"",attributeMob:t.attributeMob||DOM_ELEMENTS.tAttr?.value||""}:null}getCurrentTarget(){let e=DOM_ELEMENTS.tDef?.value;return e?{key:e,data:this.getTargetData(e)}:null}populateAllDropdowns(){Object.entries(this.config.fields).forEach(([e,t])=>{if("dropdown"!==t.type&&"set"!==t.type)return;let a=DOM_ELEMENTS[e];if(a){if(t.generator)this.populateOptions(a,this.config.setGenerators[t.generator]());else{let r="function"==typeof t.options?t.options():t.options;this.populateOptions(a,r,t.placeholder)}}})}populateOptions(e,t,a){if(!e)return;let r=document.createDocumentFragment();if(a){let l=document.createElement("option");l.value="",l.textContent=a,r.appendChild(l)}t.forEach(e=>{let t=document.createElement("option");t.value="string"==typeof e?e:e.value,t.textContent="string"==typeof e?e:e.label,e.disabled&&(t.disabled=!0),r.appendChild(t)}),e.innerHTML="",e.appendChild(r)}setFieldState(e,t,a="",r=""){if(!e)return;e.disabled=t,e.placeholder=t?r:a;let l=e.closest(".input-wrap");l&&(l.classList.toggle("locked",t),t||l.removeAttribute("data-temp-unlocked"))}clearFields(e){e.forEach(e=>{let t=DOM_ELEMENTS[e];t&&(t.value="")})}applyMobProperties(e,t="standard",a=null){e&&Object.entries(this.config.mobMapping).forEach(([r,l])=>{let i=DOM_ELEMENTS[l];if(!i)return;let s=e[r],n=this.shouldLock(l,s,t,a);i.value=n?s:"",i.disabled=n,this.state.lockStates.set(l,n);let o=i.closest(".input-wrap");if(o&&o.classList.toggle("locked",n),!n&&!s){let d=this.config.relatedFields[l];if(d&&DOM_ELEMENTS[d]){let c=DOM_ELEMENTS[d];c.value="";let u=c.closest(".input-wrap");u&&(u.classList.remove("locked"),u.setAttribute("data-temp-unlocked","1"))}}})}shouldLock(e,t,a,r){if(null!==r)return r;let l=DOM_ELEMENTS.tDef?.value||"";return"swap"===a?!!t:t&&!l.includes("Lvl.")}bindEvents(){EventManager.add(document,"change",e=>{if(AppState.get("isResultShown"))return;let t=this.config.eventMap[e.target.id];if(e.target===DOM_ELEMENTS.tDef){this.handleTargetChange();return}if(this.constants.setKeys.includes(e.target.id)){this.recordSelection(e.target),this.syncThreeSets(),this.scheduleUpdate();return}if(t){let a=this.config.fields[t];a?.onClear&&this.clearFields(a.onClear),a?.onUpdate==="updateAttackTypeUI"&&this.updateAttackTypeUI(),this.scheduleUpdate()}})}handleTargetChange(){if(this.state.isSwapping)return;let e=DOM_ELEMENTS.tDef?.value;if(!e)return;let t=this.getTargetData(e);t&&(this.applyMobProperties(t),this.syncBreakdownSwap(e),this.scheduleUpdate())}recordSelection(e){let t=this.getFormData(),a=this.state.selectionOrder.length>=3||t.blueSet&&(t.blueSetText||"").includes("*8");if(!e?.value){this.state.selectionOrder=this.state.selectionOrder.filter(t=>t!==e);return}this.state.selectionOrder=a?[e]:this.state.selectionOrder.includes(e)?this.state.selectionOrder:[...this.state.selectionOrder,e]}syncThreeSets(){let e=this.constants.setKeys.map(e=>DOM_ELEMENTS[e]).filter(Boolean),t=this.getFormData(),a=(t.blueSetText||"").includes("*8");e.forEach(e=>Array.from(e.options).forEach(e=>e.disabled=!1)),t.blueSet&&a?[DOM_ELEMENTS.vesperSet,DOM_ELEMENTS.whiteSet].forEach(e=>{e&&(Array.from(e.options).forEach(e=>e.disabled=!!e.value),e.value="")}):(this.state.selectionOrder.length>0&&Array.from(DOM_ELEMENTS.blueSet?.options||[]).forEach(e=>{e.value&&e.textContent.includes("*8")&&(e.disabled=!0)}),this.state.selectionOrder.length>=2&&e.filter(e=>!this.state.selectionOrder.includes(e)).forEach(e=>{Array.from(e.options).forEach(e=>e.disabled=!!e.value),e.value=""}),DOM_ELEMENTS.blueSet?.value&&DOM_ELEMENTS.blueSet.selectedOptions[0]?.disabled&&(DOM_ELEMENTS.blueSet.value="",this.state.selectionOrder=this.state.selectionOrder.filter(e=>e!==DOM_ELEMENTS.blueSet)))}updateAll(){let e=this.getFormData();this.updateStaticLabels(),this.updateDynamicLabels(e),this.updateConditionalFields(e),this.updateAttackTypeUI()}updateStaticLabels(){Object.entries(this.config.labels.static).forEach(([e,t])=>{DOM_ELEMENTS[e]&&(DOM_ELEMENTS[e].textContent=t)})}updateDynamicLabels(e){DOM_ELEMENTS.vesperSetLabel&&(DOM_ELEMENTS.vesperSetLabel.textContent=this.config.labels.dynamic.vesper[e.vesperSet]||"Vesper SET"),DOM_ELEMENTS.whiteSetLabel&&(DOM_ELEMENTS.whiteSetLabel.textContent=this.config.labels.dynamic.white[e.whiteSet]||"White SET (110*3)")}updateConditionalFields(e){Object.entries(this.config.fields).forEach(([t,a])=>{if("conditional"!==a.type)return;let r=DOM_ELEMENTS[t],l=DOM_ELEMENTS[`${t}Label`],i=e[a.dependsOn];if(!r||!a.active||!a.default)return;let s=i?a.active(i):a.default;r.disabled=!i,r.placeholder=s.placeholder,l&&s.label&&(l.textContent=s.label)})}updateAttackTypeUI(){let e=this.getFormData().atkType,t=document.querySelector(".form-group.pen-group"),a=document.querySelector(".form-group.crit-group");[t,a].forEach(e=>e?.classList.add("hidden")),"pen"===e&&t?(t.classList.remove("hidden"),this.setFieldState(DOM_ELEMENTS.pen,!1,"total converted raw pen + final pen..."),this.setFieldState(DOM_ELEMENTS.crit,!0)):"crit"===e&&a?(a.classList.remove("hidden"),this.setFieldState(DOM_ELEMENTS.crit,!1,"critical damage bonus..."),this.setFieldState(DOM_ELEMENTS.pen,!0)):(this.setFieldState(DOM_ELEMENTS.pen,!0),this.setFieldState(DOM_ELEMENTS.crit,!0))}scheduleUpdate(){clearTimeout(this.state.updateTimer),this.state.updateTimer=setTimeout(()=>{this.updateAll(),this.state.updateTimer=null},50)}determineSwapMode(e,t){if(!e||!t||t===e)return"none";let a=this.getTargetData(e),r=this.getTargetData(t);if(!a||!r)return"manual";let l=getTargetDefenseData(e)||{},i=getTargetDefenseData(t)||{},s={sizeMob:DOM_ELEMENTS.tSize?.value||"",raceMob:DOM_ELEMENTS.tRace?.value||"",attributeMob:DOM_ELEMENTS.tAttr?.value||""};for(let[n]of Object.entries(this.config.mobMapping)){let o=l[n],d=i[n],c=s[n];if(o&&d&&o!==d||!o&&d&&c&&c!==d)return"manual"}return"auto"}executeSwap(e,t,a){let r=this.determineSwapMode(this.getCurrentTarget()?.key,e);if("none"===r)return;this.state.isSwapping=!0,this.resetGlobalStates(),DOM_ELEMENTS.tDef&&(DOM_ELEMENTS.tDef.value=e),this.syncBreakdownSwap(e);let l=this.getTargetData(e);if(!l){this.state.isSwapping=!1;return}"auto"===r?(this.applyMobProperties(l,"swap"),"function"==typeof processMainCalculation&&processMainCalculation(),"function"==typeof showSnackbar&&showSnackbar("Auto calc triggered!"),this.scheduleUpdate()):(this.applyMobPropertiesForManualSwap(l),this.unlockFieldsForManualSwap(a),this.updateUIForManualSwap(t,a),this.scheduleUpdate()),this.state.isSwapping=!1}applyMobPropertiesForManualSwap(e){Object.entries(this.config.mobMapping).forEach(([t,a])=>{let r=DOM_ELEMENTS[a];if(!r)return;r.value=e[t]||"",r.disabled=!0,this.state.lockStates.set(a,!0);let l=r.closest(".input-wrap");l&&l.classList.add("locked")})}unlockFieldsForManualSwap(e){let t=[...this.config.calculationFields,e?"pen":"crit"];t.forEach(e=>{let t=DOM_ELEMENTS[e];if(!t)return;let a=t.closest(".input-wrap");a?.querySelector('input[type="number"]')&&(a.classList.remove("locked"),a.dataset.tempUnlocked="1"),t.disabled=!1}),"function"==typeof unbindInputLockGuard&&unbindInputLockGuard()}updateUIForManualSwap(e,t){DOM_ELEMENTS.submit&&(DOM_ELEMENTS.submit.disabled=!1),this.config.disableButtons.forEach(e=>{DOM_ELEMENTS[e]&&(DOM_ELEMENTS[e].disabled=!0)}),DOM_ELEMENTS.hasil&&(DOM_ELEMENTS.hasil.dataset.specificMode="0",DOM_ELEMENTS.hasil.textContent="Input your stats to see the result..."),DOM_ELEMENTS.rec&&(DOM_ELEMENTS.rec.textContent="Balancing stat recommendations for a higher output multiplier.");let a=t?DOM_ELEMENTS.pen:DOM_ELEMENTS.crit;"function"==typeof scrollAndFocusElement&&scrollAndFocusElement(a,"Target swapped - please verify stats and recalculate!"),"function"==typeof validateRequiredFields&&validateRequiredFields(),"function"==typeof validateStatsVsTarget&&validateStatsVsTarget(e)}syncBreakdownSwap(e){let t=document.querySelector("#breakdown-swap");t&&t.value!==e&&(t.value=e)}resetGlobalStates(){AppState.reset(),["testSpear","testReaper"].forEach(e=>{DOM_ELEMENTS[e]?.classList.remove("activated")})}createSwapSelect(e,t){let a=document.createElement("select");a.id="breakdown-swap",a.className="breakdown-swap";let r=+e.penVal,l=+e.dmgVal,i=this.getCurrentTarget()?.key,s=getTargetDefenseData(),n=Object.keys(s).map(e=>{let a=s[e],n=+(a?.def||0),o=+(a?.dmgred||0),d=this.determineSwapMode(i,e),c="auto"===d&&(l<=o||t&&r<=n),u=c?`${e} (cant auto calc)`:e;return`<option value="${e}"${c?" disabled":""}>${u}</option>`});return a.innerHTML=n.join(""),a.value=e.tDefKey||"Dummy (NO DEF)",a.hasAttribute("data-dropdown-bound")||(EventManager.add(a,"change",()=>this.executeSwap(a.value,e,t)),a.setAttribute("data-dropdown-bound","true")),a}destroy(){this.state.isDestroyed=!0,this.state.isSwapping=!1,this.cleanup(),this.state.selectionOrder=[],this.state.lockStates.clear()}}const dropdownManager=new DropdownManager;class ValidationSSoT{constructor(){this.INVALID_CLASS="invalid-value",this.touchedFields=new Set,this.snackbarCooldowns=new Set,this.isInitialized=!1,this.autoInit()}isPenOrDmg=e=>["pen","dmg"].includes(e?.id);isRelatedNumeric=e=>["race","attr"].includes(e?.id);isNumeric=e=>e?.type==="number"||e?.classList.contains("numeric-input")||this.isPenOrDmg(e)||this.isRelatedNumeric(e);isValidNumber=e=>!isNaN(+e)&&isFinite(+e);normalizeInput=e=>String(e).replace(/[^\d.,]/g,"").replace(/,/g,".").replace(/\.{2,}/g,".").replace(/^\./,"0.").replace(/\.$/,"");showMessage=e=>"function"==typeof showSnackbar&&showSnackbar(e);canShowSnackbar(e){return!this.snackbarCooldowns.has(e)&&(this.snackbarCooldowns.add(e),setTimeout(()=>this.snackbarCooldowns.delete(e),2e3),!0)}validateField(e,t=!1){let a=e.value?.trim()||"",r=this.isRelatedNumeric(e);if(r){let l="race"===e.id?DOM_ELEMENTS.tRace:DOM_ELEMENTS.tAttr;if(!l?.value&&!a)return{isValid:!0,reason:"related_empty"};if(l?.value&&!a)return{isValid:!1,reason:"related_required"}}if(!a)return{isValid:!1,reason:"empty"};if(this.isNumeric(e)&&!this.isValidNumber(a))return{isValid:!1,reason:"invalid_number"};let i=+a,[s,n]=[e.getAttribute("min"),e.getAttribute("max")];if(s&&i<+s){if(t&&this.canShowSnackbar(e.id)){let o=e.getAttribute("data-field-name")||e.id||"Field";this.showMessage(`${o} must be at least ${s}`)}return{isValid:!1,reason:"below_min"}}if(n&&i>+n)return t&&this.canShowSnackbar(e.id)&&this.showMessage("what are you doing?"),{isValid:!1,reason:"above_max"};if(this.isPenOrDmg(e)){let d=getTargetDefenseData(DOM_ELEMENTS.tDef?.value),c="pen"===e.id?+d?.def||0:+d?.dmgred||0;if(i<=c){if(t&&this.canShowSnackbar(e.id)){let u=(c+8).toFixed(2),m="pen"===e.id?"Final PEN":"Final P/M Bonus",p=DOM_ELEMENTS.tDef?.options?.[DOM_ELEMENTS.tDef.selectedIndex]?.textContent||"target";this.showMessage(`Need at least ${u} ${m} vs ${p}`)}return{isValid:!1,reason:"threshold_not_met"}}}return{isValid:!0}}updateFieldState=(e,t)=>{this.touchedFields.has(e.id)&&e.classList.toggle(this.INVALID_CLASS,!t)};setupField(e){let t=(t=!1)=>{let a=this.validateField(e,t);this.updateFieldState(e,a.isValid)},a=()=>{if(this.isNumeric(e)){let t=this.normalizeInput(e.value);t!==e.value&&(e.value=t)}};EventManager.add(e,"focus",()=>this.touchedFields.add(e.id)),EventManager.add(e,"input",()=>(a(),t(!1))),EventManager.add(e,"blur",()=>t(!0)),EventManager.add(e,"change",()=>t(!0))}checkReady=()=>void 0!==DOM_ELEMENTS&&DOM_ELEMENTS;init(){return!this.isInitialized&&!!this.checkReady()&&(["atkType","weapon","wElem","tDef","tSize","pen","crit","dmg","elemEnh","sizeEnh","race","attr","dmgStack"].map(e=>DOM_ELEMENTS[e]).filter(Boolean).forEach(e=>this.setupField(e)),DOM_ELEMENTS.tDef&&EventManager.add(DOM_ELEMENTS.tDef,"change",()=>{[DOM_ELEMENTS.pen,DOM_ELEMENTS.dmg].filter(e=>e?.value.trim()).forEach(e=>{let t=this.validateField(e,this.canShowSnackbar(e.id));this.updateFieldState(e,t.isValid)})}),this.isInitialized=!0)}autoInit(){if("complete"===document.readyState)return this.init();let e=()=>this.init();"loading"===document.readyState&&document.addEventListener("DOMContentLoaded",e),window.addEventListener("load",e)}validateAllRequired(){let e=[{el:DOM_ELEMENTS.atkType,name:"Attack Type"},{el:DOM_ELEMENTS.weapon,name:"Weapon Type"},{el:DOM_ELEMENTS.wElem,name:"Weapon Attribute"},{el:DOM_ELEMENTS.tDef,name:"Target Boss"},{el:DOM_ELEMENTS.tSize,name:"Target Size"},{el:DOM_ELEMENTS.pen,name:"Final P M PEN %",condition:()=>DOM_ELEMENTS.atkType?.value==="pen"},{el:DOM_ELEMENTS.crit,name:"Critical DMG Bonus %",condition:()=>DOM_ELEMENTS.atkType?.value==="crit"},{el:DOM_ELEMENTS.dmg,name:"Final P M DMG Bonus %"},{el:DOM_ELEMENTS.elemEnh,name:"Element Enhance %"},{el:DOM_ELEMENTS.sizeEnh,name:"DMG to Size %"},{el:DOM_ELEMENTS.race,name:"DMG to Race %",condition:()=>DOM_ELEMENTS.race&&!DOM_ELEMENTS.race.disabled},{el:DOM_ELEMENTS.attr,name:"DMG to Attribute %",condition:()=>DOM_ELEMENTS.attr&&!DOM_ELEMENTS.attr.disabled},{el:DOM_ELEMENTS.dmgStack,name:"Final DMG Bonus %"}];for(let t of e){if(!t.el||t.condition&&!t.condition())continue;this.touchedFields.add(t.el.id);let a=this.validateField(t.el,this.canShowSnackbar(t.el.id));if(this.updateFieldState(t.el,a.isValid),!a.isValid)return"function"==typeof scrollAndFocusElement&&scrollAndFocusElement(t.el),!1}return!0}validateStats(e,t=null){let a=[..."pen"===e?.atkType?.toLowerCase()&&DOM_ELEMENTS.pen?[DOM_ELEMENTS.pen]:[],...DOM_ELEMENTS.dmg?[DOM_ELEMENTS.dmg]:[]];for(let r of a){this.touchedFields.add(r.id);let l=this.validateField(r,this.canShowSnackbar(r.id));if(this.updateFieldState(r,l.isValid),!l.isValid&&(t===r||!t))return"function"==typeof scrollAndFocusElement&&scrollAndFocusElement(r),!1}return!0}destroy(){this.touchedFields.clear(),this.snackbarCooldowns.clear(),this.isInitialized=!1}}const ValidationSSoTInstance=new ValidationSSoT,normalizeNumericInput=(e,t)=>{if(!e)return;let a=ValidationSSoTInstance.normalizeInput(t??e.value);e.value=a;let r=ValidationSSoTInstance.validateField(e,ValidationSSoTInstance.isPenOrDmg(e));ValidationSSoTInstance.updateFieldState(e,r.isValid)},validateRequiredFields=()=>ValidationSSoTInstance.validateAllRequired(),validateStatsVsTarget=(e,t=null)=>ValidationSSoTInstance.validateStats(e,t),PASSIVE_SUPPORT=(()=>{let e=!1;try{let t=Object.defineProperty({},"passive",{get:()=>(e=!0,!1)});window.addEventListener("test-passive",()=>{},t),window.removeEventListener("test-passive",()=>{},t)}catch(a){}return e})(),POINTER_SUPPORT="PointerEvent"in window,opts=!!PASSIVE_SUPPORT&&{passive:!1};function showLockedInputMessage(e){let t=e?.currentTarget;if(!t?.classList?.contains("locked"))return;let a=Date.now();t._lastLockTimestamp&&a-t._lastLockTimestamp<500||(t._lastLockTimestamp=a,e?.cancelable&&(e.preventDefault(),e.stopPropagation()),(!window._lastSnackbarTime||a-window._lastSnackbarTime>3e3)&&(window._lastSnackbarTime=a,"function"==typeof showSnackbar&&showSnackbar("Your Stats Locked!")))}function bindInputLockGuard(e){if(!e?.nodeType||e.hasAttribute?.("data-lock-bound"))return;let t=POINTER_SUPPORT?[["pointerdown",showLockedInputMessage,opts]]:[["touchstart",showLockedInputMessage,opts],["click",showLockedInputMessage,!1]];t.forEach(([t,a,r])=>EventManager.add(e,t,a,r)),e._lockListeners=t,e.setAttribute("data-lock-bound","1")}function unbindInputLockGuard(e){e?.nodeType&&e.hasAttribute?.("data-lock-bound")&&(delete e._lockListeners,delete e._lastLockTimestamp,e.removeAttribute("data-lock-bound"))}function lockAllInputs(){document.querySelectorAll(".input-wrap").forEach(e=>{if(!e?.nodeType)return;let t=e.querySelectorAll("input, select, textarea");t.length&&(t.forEach(e=>e?.nodeType&&(e.disabled=!0)),e.classList.add("locked"),bindInputLockGuard(e))})}function unlockAllInputs(){document.querySelectorAll(".input-wrap").forEach(e=>{if(!e?.nodeType)return;let t=e.querySelectorAll("input, select, textarea");t.length&&(t.forEach(e=>e?.nodeType&&(e.disabled=!1)),e.classList.remove("locked"),unbindInputLockGuard(e))})}let snackbarTimer=null;function showSnackbar(e){let t=DOM_ELEMENTS.snackbar;if(t){if(t.textContent=e,clearTimeout(snackbarTimer),t.classList.remove("show"),t.offsetHeight,t.classList.add("show"),isMobile()&&!AppState.get("keyboardListenersAdded")){AppState.set("keyboardListenersAdded",!0);let a=document.querySelector("input[type=number]");if(window.visualViewport){let r=()=>{let e=window.innerHeight-(window.visualViewport.height||window.innerHeight);t.style.bottom=`${80+e}px`};EventManager.add(window.visualViewport,"resize",r,{passive:!0}),EventManager.add(window.visualViewport,"scroll",r,{passive:!0})}else a&&(EventManager.add(a,"focusin",()=>t.style.bottom="300px"),EventManager.add(a,"focusout",()=>t.style.bottom="16px"))}snackbarTimer=setTimeout(()=>t.classList.remove("show"),3e3)}}function scrollAndFocusElement(e,t){t&&showSnackbar(t);let a=e.getBoundingClientRect().top+window.pageYOffset-80;return window.scrollTo({top:a,behavior:"smooth"}),e.disabled||e.focus({preventScroll:!0}),!1}const TOOLTIP_CONFIG={"#dmgStackTips":"<strong>Final DMG Bonus</strong> and <strong>F. P/M DMG BONUS</strong> are two <strong>different</strong> things! Look for it in your <strong>detailed stats</strong> where it shows as <strong>Final Damage Stack</strong> or <strong>Final Damage Bonus</strong>. Make sure you don't have any buffs active. Can't find it? Just set 0.","#targetRaceTips":"Specific MVP/MINi will <strong>auto sync and lock</strong> this option. Select <strong>Avg Lvl Boss</strong> if you want to target spesific race!","#targetAttrTips":"also same with race.","#dmgRaceTips":"Unlocked when target race selected, minimum valid value is 0.","#dmgAttrTips":"same condition with dmg to race"};function createTooltip(e,t){if(!e||!t)return;let a=document.createElement("div");a.className="tooltip-wrap",a.innerHTML=t,document.body.appendChild(a);let r=!1,l=null,i=()=>{let t=e.getBoundingClientRect(),r=window.pageXOffset,l=window.pageYOffset;a.style.cssText="visibility:hidden;display:block";let i=a.offsetWidth,s=a.offsetHeight;a.style.cssText="";let n=t.left+r+t.width/2,o=window.innerWidth-i-16,d=t.top+l-s-12;d<16+l?(d=t.bottom+l+12,a.classList.add("flipped")):a.classList.remove("flipped"),a.style.transform=`translate(${Math.max(16,Math.min(n-i/2,o))}px, ${d}px)`},s=()=>{r||(clearTimeout(l),i(),r=!0,a.classList.add("show"))},n=()=>{r&&(a.classList.remove("show"),r=!1)},o=e=>{e&&(e.stopPropagation(),e.preventDefault()),r?n():s()},d=t=>{!r||e.contains(t.target)||a.contains(t.target)||n()},c=t=>{"Escape"===t.key&&r?n():("Enter"===t.key||" "===t.key)&&t.target===e&&(t.preventDefault(),o(t))},u=()=>{r&&(clearTimeout(l),l=setTimeout(i,16))};EventManager.add(e,"click",o),EventManager.add(e,"touchend",e=>{e.preventDefault(),o(e)},{passive:!1}),EventManager.add(document,"click",d),EventManager.add(document,"touchend",d,{passive:!0}),EventManager.add(document,"keydown",c),EventManager.add(window,"resize",u,{passive:!0}),EventManager.add(window,"scroll",u,{passive:!0})}function setupTooltips(e){Object.entries(e).forEach(([e,t])=>{try{let a="string"==typeof e?document.querySelectorAll(e):e instanceof Element?[e]:[];a.forEach(e=>{e instanceof Element&&createTooltip(e,t)})}catch(r){}})}setupTooltips(TOOLTIP_CONFIG);class StickyHandler{constructor(){this.state={isActive:!1,isCollapsed:!1,isMobile:!1,animating:!1},this.config={MOBILE_BREAKPOINT:480,BUTTON_HEIGHT:56,ANIMATION_DELAY:60,TRANSITION_DURATION:300,DOM_REINJECT_DELAY:50,OBSERVER_DEBOUNCE:16,RESIZE_DEBOUNCE:100,CLEANUP_DELAY:320},this.selectors={resetRek:"resetRekomenBtn",resetAll:"resetAllBtn",swapBoss:"breakdown-swap",stickyStart:()=>DOM_ELEMENTS?.hasil,testSpear:()=>DOM_ELEMENTS?.testSpear,testReaper:()=>DOM_ELEMENTS?.testReaper},this.buttonOrder=["toggleBtn","swapBoss","testSpear","testReaper","resetRek","resetAll","backBtn"],this.textButtons=["resetRek","resetAll","testSpear","testReaper"],this.controlButtons=[{id:"toggleStickyBtn",class:"sticky-toggle",key:"toggleBtn",handler:"handleToggle"},{id:"backToHasilBtn",class:"sticky-back",key:"backBtn",handler:"handleBack"}],this.elements=new Map,this.timeouts=new Map,this.scrollRAF=null,this.observer=null,this.initialized=!1,this.init()}initElements(){this.elements.clear(),Object.entries(this.selectors).forEach(([e,t])=>{let a="function"==typeof t?t():document.getElementById(t);a&&(this.elements.set(e,a),this.storeOriginalText(a,e),"swapBoss"===e&&this.state.isActive&&this.state.isMobile&&(a.dataset.stickyPreserve="true"))}),this.createControlButtons()}storeOriginalText(e,t){this.textButtons.includes(t)&&!e.dataset.originalText&&(e.dataset.originalText=e.textContent.trim()||"")}createControlButtons(){this.controlButtons.forEach(({id:e,class:t,key:a,handler:r})=>{let l=document.getElementById(e);l||((l=document.createElement("button")).id=e,l.className=t,document.body.appendChild(l)),this.elements.set(a,l),this.bindButtonEvent(l,r)});let e=this.elements.get("toggleBtn");e&&(e.dataset.collapse="false")}bindButtonEvent(e,t){e.dataset.bound||(EventManager.add(e,"click",e=>this[t](e)),e.dataset.bound="true")}getOrderedButtons(){return this.buttonOrder.map(e=>this.elements.get(e)).filter(Boolean)}handleToggle=e=>{if(e.preventDefault(),this.state.animating)return;this.state.animating=!0,this.state.isCollapsed=!this.state.isCollapsed;let t=this.elements.get("toggleBtn");t&&(t.dataset.collapse=String(this.state.isCollapsed)),navigator.vibrate&&navigator.vibrate(50),this.applySticky(),this.scheduleTimeout("animationEnd",()=>{this.state.animating=!1},this.config.TRANSITION_DURATION)};handleBack=e=>{e.preventDefault();let t=this.elements.get("stickyStart");t&&t.scrollIntoView({behavior:"smooth",block:"start"})};handleScroll=()=>{this.scrollRAF||(this.scrollRAF=requestAnimationFrame(()=>{this.updateSticky(),this.scrollRAF=null}))};handleResize=()=>{this.scheduleTimeout("resize",()=>{this.updateSticky()},this.config.RESIZE_DEBOUNCE)};scheduleTimeout(e,t,a){this.clearTimeout(e),this.timeouts.set(e,setTimeout(t,a))}clearTimeout(e){let t=this.timeouts.get(e);t&&(clearTimeout(t),this.timeouts.delete(e))}clearAllTimeouts(){this.timeouts.forEach(e=>clearTimeout(e)),this.timeouts.clear()}updateMobileState(){let e=window.innerWidth<=this.config.MOBILE_BREAKPOINT,t=e!==this.state.isMobile;return this.state.isMobile=e,t}updateSticky(){let e=this.updateMobileState();if(!this.state.isMobile){(e||this.state.isActive)&&(this.state.isActive=!1,this.removeSticky());return}let t=this.elements.get("stickyStart");if(!t)return;let a=t.getBoundingClientRect(),r=a.top<=0;r!==this.state.isActive&&(this.state.isActive=r,this.state.isActive?this.applySticky():this.removeSticky())}applySticky(){let e=this.getOrderedButtons();if(0===e.length)return;let t=e[0].classList.contains("sticky");e.forEach((e,a)=>{let r=e===this.elements.get("toggleBtn"),l=this.state.isCollapsed?0:-(a*this.config.BUTTON_HEIGHT),i=this.state.isCollapsed&&!r?"0.4":"1";e.classList.contains("sticky")||e.classList.add("sticky"),e.classList.toggle("collapsed",this.state.isCollapsed),t?this.updateButtonPosition(e,l,i):this.animateButtonIn(e,a,l)}),this.scheduleTimeout("textUpdate",()=>{this.updateButtonText()},t?0:200)}animateButtonIn(e,t,a){e.style.cssText="transform: translate3d(0, 50px, 0); opacity: 0; transition: none;",this.scheduleTimeout(`buttonIn-${t}`,()=>{e.style.cssText=`transform: translate3d(0, ${a}px, 0); opacity: 1; transition: all 400ms cubic-bezier(0.34, 1.56, 0.64, 1);`},t*this.config.ANIMATION_DELAY)}updateButtonPosition(e,t,a){e.style.cssText=`transform: translate3d(0, ${t}px, 0); opacity: ${a};`}removeSticky(){let e=this.getOrderedButtons();0!==e.length&&(e.forEach(e=>{e.classList.contains("sticky")&&(e.style.cssText="transform: translate3d(0, 0, 0); opacity: 0.3; transition: transform 300ms ease, opacity 200ms ease;")}),this.scheduleTimeout("cleanup",()=>{this.cleanupSticky(e)},this.config.CLEANUP_DELAY))}cleanupSticky(e){e.forEach(e=>{e.classList.remove("sticky","collapsed"),e.style.cssText="",e.dataset.originalText&&(e.textContent=e.dataset.originalText)})}updateButtonText(){let e=this.state.isActive;this.textButtons.forEach(t=>{let a=this.elements.get(t);a&&(a.textContent=e?"":a.dataset.originalText||"")})}setupEventListeners(){EventManager.add(window,"scroll",this.handleScroll,{passive:!0}),EventManager.add(window,"resize",this.handleResize,{passive:!0})}setupDOMObserver(){"undefined"==typeof MutationObserver||this.observer||(this.observer=new MutationObserver(e=>{let t=!1;for(let a of e){for(let r of a.addedNodes)if("breakdown-swap"===r.id||1===r.nodeType&&r.querySelector&&r.querySelector("#breakdown-swap")){t=!0;break}if(t)break}if(!t){this.scheduleTimeout("observer",()=>this.updateSticky(),this.config.OBSERVER_DEBOUNCE);return}this.scheduleTimeout("observer",()=>{this.initElements(),this.state.isMobile&&this.state.isActive?this.scheduleTimeout("domReinject",()=>{this.applySticky()},this.config.DOM_REINJECT_DELAY):this.updateSticky()},this.config.OBSERVER_DEBOUNCE)}),this.observer.observe(document.body,{childList:!0,subtree:!0}))}init(){let e=()=>{this.initialized||(this.initElements(),this.setupEventListeners(),this.setupDOMObserver(),this.updateSticky(),this.initialized=!0)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e,{once:!0}):e()}destroy(){this.clearAllTimeouts(),this.scrollRAF&&(cancelAnimationFrame(this.scrollRAF),this.scrollRAF=null),this.observer&&(this.observer.disconnect(),this.observer=null),this.elements.clear(),this.initialized=!1}}const stickyHandler=new StickyHandler,accordionManager=(()=>{let e="max-height 320ms cubic-bezier(0.25, 0.8, 0.25, 1), opacity 320ms ease-out",t=new Map,a=(e,t,a)=>{let r=!1,l=null,i=()=>{l&&(cancelAnimationFrame(l),l=null),r=!1},s=(e,t=1)=>{Object.assign(a.style,{maxHeight:e,opacity:t.toString()})},n=t=>{if(!r){if(r=!0,i(),t)e.setAttribute("open",""),s("0px",.3),l=requestAnimationFrame(()=>{let e=a.scrollHeight+"px";s(e,1);let t=()=>{s("none",1),r=!1};a.addEventListener("transitionend",t,{once:!0})});else{let n=a.scrollHeight+"px";s(n,1),l=requestAnimationFrame(()=>{s("0px",.3);let t=()=>{e.removeAttribute("open"),r=!1};a.addEventListener("transitionend",t,{once:!0})})}}};return{animate:n,cleanup:i,get isAnimating(){return r}}},r=()=>{document.querySelectorAll("details").forEach(e=>{let r=e.querySelector("summary"),l=e.querySelector(".body");if(!r||!l||t.has(e))return;Object.assign(l.style,{transition:"max-height 320ms cubic-bezier(0.25, 0.8, 0.25, 1), opacity 320ms ease-out",overflow:"hidden",maxHeight:e.hasAttribute("open")?"none":"0px",opacity:e.hasAttribute("open")?"1":"0.3"});let i=a(e,r,l);t.set(e,i);let s=t=>{if(t.preventDefault(),i.isAnimating)return;let a=e.hasAttribute("open");i.animate(!a)};EventManager.add(r,"click",s)})};r();let l=new MutationObserver(e=>{e.forEach(e=>{"childList"===e.type&&e.addedNodes.length>0&&requestAnimationFrame(r)})});l.observe(document.body,{childList:!0,subtree:!0});let i=()=>{l.disconnect(),t.forEach(e=>e.cleanup()),t.clear()};return EventManager.add(window,"beforeunload",i),{destroy:i,reinitialize:r}})(),modalManager=(()=>{let{log:e,openLog:t,closeLog:a}=DOM_ELEMENTS||{};if(!e)return{show(){},hide(){},destroy(){}};let r=e.querySelector(".modal-content, .log-content, .modal-body")||e.firstElementChild,l="cubic-bezier(0.25, 0.8, 0.25, 1)",i={modal:{display:"none",transition:`opacity 280ms ${l}, transform 280ms ${l}, backdrop-filter 280ms ${l}`,transformOrigin:"center"},content:r?{transition:`transform 280ms ${l}, opacity 280ms ${l}`}:null};Object.assign(e.style,i.modal),r&&Object.assign(r.style,i.content);let s=!1,n=null,o=null,d=()=>{n&&(cancelAnimationFrame(n),n=null),o&&(clearTimeout(o),o=null)},c=()=>{s&&(s=!1,d(),Object.assign(e.style,{opacity:"0",transform:"scale(0.96)",backdropFilter:"blur(0px)",backgroundColor:"transparent"}),r&&Object.assign(r.style,{transform:"translateY(-8px) scale(0.98)",opacity:"0.5"}),o=setTimeout(()=>{s||(e.style.display="none")},280))},u=()=>{s||(s=!0,d(),e.style.display="flex",n=requestAnimationFrame(()=>{Object.assign(e.style,{opacity:"1",transform:"scale(1)",backdropFilter:"blur(6px)",backgroundColor:"rgba(0, 0, 0, 0.3)"}),r&&Object.assign(r.style,{transform:"translateY(0) scale(1)",opacity:"1"})}))},m=e=>{e.stopPropagation(),u()},p=e=>{"Escape"===e.key&&s&&c()},E=e=>{s&&r&&!r.contains(e.target)&&e.target!==t&&c()};EventManager.add(t,"click",m),EventManager.add(a,"click",c),EventManager.add(document,"keydown",p),EventManager.add(document,"click",E);let M=()=>{d()};return EventManager.add(window,"beforeunload",M),{show:u,hide:c,destroy:M}})();function clearCache(e=null){let t=confirm("Also clear calculation cache?");scrollAndFocusElement(DOM_ELEMENTS.topOfPage,t?"Stats and Cache Cleared!":"Stats Cleared!"),t&&(e?cache.clear(e):(cache.clear(),cache.rewarm(),RandomGenerator.reset()))}function resetAllData(){if(!confirm("Reset all data and inputs?"))return;debounceMap.forEach(e=>clearTimeout(e)),debounceMap.clear(),snackbarTimer&&(clearTimeout(snackbarTimer),snackbarTimer=null),stickyHandler?.scrollRAF&&(cancelAnimationFrame(stickyHandler.scrollRAF),stickyHandler.scrollRAF=null),stickyHandler?.timeouts&&(stickyHandler.timeouts.forEach(e=>clearTimeout(e)),stickyHandler.timeouts.clear()),dropdownManager?.state?.updateTimer&&(clearTimeout(dropdownManager.state.updateTimer),dropdownManager.state.updateTimer=null),AppState.reset(),ValidationSSoTInstance&&(ValidationSSoTInstance.touchedFields.clear(),ValidationSSoTInstance.snackbarCooldowns.clear()),dropdownManager?.state&&(dropdownManager.state.selectionOrder=[],dropdownManager.state.lockStates.clear(),dropdownManager.state.isDestroyed=!1,dropdownManager.state.isSwapping=!1,dropdownManager.state.updateTimer=null),stickyHandler?.state&&(stickyHandler.state.isActive=!1,stickyHandler.state.isCollapsed=!1,stickyHandler.state.animating=!1),delete window._lastSnackbarTime,clearCache(),["input","select"].forEach(e=>{document.querySelectorAll(e).forEach(e=>{e.value="",e.disabled=!1})});let e=new Map([[DOM_ELEMENTS.hasil,"Input your stats to see the result..."],[DOM_ELEMENTS.rec,"Balancing stat recommendations for a higher output multiplier."]]);e.forEach((e,t)=>{t&&(t.textContent=e)}),DOM_ELEMENTS.hasil?.dataset&&(delete DOM_ELEMENTS.hasil.dataset.showFullPrecision,delete DOM_ELEMENTS.hasil.dataset.specificMode);let t=new Map([[DOM_ELEMENTS.submit,{disabled:!1}],[DOM_ELEMENTS.resetRek,{disabled:!0}],[DOM_ELEMENTS.resetAll,{disabled:!0}],[DOM_ELEMENTS.testSpear,{disabled:!0}],[DOM_ELEMENTS.testReaper,{disabled:!0}]]);t.forEach((e,t)=>{t&&Object.assign(t,e)}),DOM_ELEMENTS.openLog?.classList.remove("locked"),[DOM_ELEMENTS.testSpear,DOM_ELEMENTS.testReaper].forEach(e=>{e?.classList.remove("activated")}),document.querySelectorAll(`.${ValidationSSoTInstance.INVALID_CLASS}`).forEach(e=>{e.classList.remove(ValidationSSoTInstance.INVALID_CLASS)}),document.querySelectorAll(".input-wrap.locked").forEach(e=>{e.classList.remove("locked"),e.removeAttribute("data-lock-bound"),e.removeAttribute("data-temp-unlocked"),delete e._lockListeners,delete e._lastLockTimestamp}),document.querySelectorAll(".sticky").forEach(e=>{e.classList.remove("sticky","collapsed"),e.style.cssText="",e.dataset.originalText&&(e.textContent=e.dataset.originalText)});let a=document.getElementById("toggleStickyBtn");a&&(a.dataset.collapse="false"),DOM_ELEMENTS.snackbar&&(DOM_ELEMENTS.snackbar.classList.remove("show"),DOM_ELEMENTS.snackbar.style.cssText=""),unlockAllInputs(),unbindInputLockGuard(),dropdownManager.cleanup(),dropdownManager.init()}(()=>{if(window._eventsAlreadyBound)return;window._eventsAlreadyBound=!0;let e=new Map([[DOM_ELEMENTS.testSpear,simulateFlash],[DOM_ELEMENTS.testReaper,simulateFlash],[DOM_ELEMENTS.submit,processMainCalculation],[DOM_ELEMENTS.resetRek,()=>{regenerateRecommendations(),showSnackbar?.("Table Refreshed!")}],[DOM_ELEMENTS.resetAll,resetAllData]]);e.forEach((e,t)=>{t?.addEventListener&&(EventManager.add(t,"click",e),(t===DOM_ELEMENTS.testSpear||t===DOM_ELEMENTS.testReaper)&&t.classList.remove("activated"))})})(),EventManager.add(window,"beforeunload",()=>{EventManager.removeAll(),cache.clear(),RandomGenerator.reset(),dropdownManager?.destroy(),ValidationSSoTInstance?.destroy(),stickyHandler?.destroy(),accordionManager?.destroy(),modalManager?.destroy(),debounceMap.clear()});